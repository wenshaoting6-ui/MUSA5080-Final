arrange(week_date) %>%
fill(comcpi, .direction = "down")
df_census=df%>%
left_join(philly_tract_data,by="GEOID")
df_census_sf=df_census%>%
left_join(philly_tract_sf,by="GEOID")
View(df_census_sf)
View(df)
df=df%>%
arrange(week_date)%>%
fill(foodcpi, .direction = "up")
df_census=df%>%
left_join(philly_tract_data,by="GEOID")
df_census_sf=df_census%>%
left_join(philly_tract_sf,by="GEOID")
View(df_census_sf)
phillyrental_proj_1619=phillyrental_proj_1619%>%
st_join(philly_tract_sf,join = st_within)
df_census_sf.test=phillyrental_proj_1923%>%
mutate(date=ym(DATE_POSTED))%>%
select(GEOID,RENT_PRICE,DATE_POSTED)
df_census_sf.test=phillyrental_proj_1923%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,DATE_POSTED)%>%
group_by(c(GEOID,date))%>%
summarise(median_rent=median(RENT_PRICE))
summary(phillyrental_proj_1923)
is.na(phillyrental_proj_1923$GEOID)
summary(is.na(phillyrental_proj_1923$GEOID))
df_census_sf.test=phillyrental_proj_1923%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,DATE_POSTED)%>%
group_by(c(GEOID,date))%>%
summarise(median_rent=median(RENT_PRICE))
df_census_sf.test=phillyrental_proj_1923%>%
st_drop_geometry()
df_census_sf.test=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,DATE_POSTED)%>%
group_by(c(GEOID,date))%>%
summarise(median_rent=median(RENT_PRICE))
df_census_sf.test=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,DATE_POSTED)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
df_census_sf.test=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))
View(df_census_sf.test)
df_census_sf.test=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
View(df_census_sf.test)
rent_by_month_tract=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
df.test=df%>%
mutate(date=format(week_date,"%Y-%m"))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))
View(df.test)
count(is.na(df.test$median_rent))
df=df%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))
df=df%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))
View(df)
summary(df)
df=read.csv(here("data/philadelphia_monthly_2020_2021.csv"))
df$week_date <- my(df$month)
df$first_of_month=floor_date(df$week_date,"month")
summary(df)
df$quarter=quarter(df$week_date)
df$year=year(df$week_date)
df$yearqu=paste0(df$year, df$quarter)
wage_data$yearqu=paste0(wage_data$year,wage_data$qtr)
df=wage_data%>%
select(yearqu,avg_wkly_wage)%>%
right_join(df,by="yearqu")
food=read.csv(here('data/food.csv'))
electricity=read.csv(here('data/electricity.csv'))
commodities=read.csv(here('data/commodities.csv'))
#merge with electricity cpi
df$month=month(df$week_date)
electricity$month=as.numeric(gsub("M","",electricity$Period))
df$yearm=paste0(df$year,df$month)
electricity$yearm=paste0(electricity$Year,electricity$month)
df=electricity%>%
mutate(electricitycpi=Value)%>%
select(yearm,electricitycpi)%>%
right_join(df,by="yearm")
#merge with food cpi
food$first_of_month=ym(food$Label)
df=food%>%
mutate(foodcpi=Value)%>%
select(first_of_month,foodcpi)%>%
right_join(df, by="first_of_month")
df=df%>%
arrange(week_date)%>%
fill(foodcpi, .direction = "up")
#merge with commodities cpi
commodities = commodities %>%
mutate(
comcpi = Value,
half_year_date = case_when(
Period == "S01" ~ ymd(paste(Year, "01", "01")), # Half 1 -> Jan 1
Period == "S02" ~ ymd(paste(Year, "07", "01"))  # Half 2 -> Jul 1
)
) %>%
select(half_year_date, comcpi)
df = df %>%
left_join(commodities, by = c("first_of_month" = "half_year_date"))
df = df %>%
arrange(week_date) %>%
fill(comcpi, .direction = "down")
df_census=df%>%
left_join(philly_tract_data,by="GEOID")
df_census_sf=df_census%>%
left_join(philly_tract_sf,by="GEOID")
#calculate rent by month and tract
rent_by_month_tract=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
#merge with evictiondata
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))
summary(df_final)
View(df_final)
# Calculate the median / mean to plot
filings_median <- median(df_census_sf$filings_avg, na.rm = TRUE)
ggplot(df, aes(filings_avg)) +
geom_histogram(bins = 60, fill = "darkseagreen3", color = "black") +
geom_vline(xintercept = filings_median, linetype = 5) +
annotate("text",
x = filings_median,
y = 6300,
label = "Median",
hjust = -0.2,
color = "black",
size = 3) +
scale_x_continuous() +
labs(title = "Distribution of Weekly Eviction Rate",
subtitle = "For Philadelphia Residential Properties in 2023-2024",
x = "Eviction Rate",
y = "Count") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
View(df_census_sf)
set.seed(123)
n <- nrow(for_model_building)
n <- nrow(df_final_sf)
n <- nrow(df_final)
train_data <- df_final[train_indices, ]
# 70% training, 30% testing
train_indices <- sample(1:n, size = 0.7 * n)
train_data <- df_final[train_indices, ]
test_data <- df_final[-train_indices, ]
#run regression based on houses own characteristic
options(scipen = 999)
colnames(df_final)
df_final$evibypop=df_final$filings_avg/df_final$total_pop
unemployment=read.csv(data/unemployment.csv)
unemployment=read.csv(data/"unemployment.csv")
unemployment=read.csv("data/unemployment.csv")
View(unemployment)
unemployment$week_date=ym(Label)
unemployment$week_date=ym(employment$Label)
unemployment$week_date=ym(unemployment$Label)
df=unemployment%>%
mutate(unemployment_rate=Value)%>%
select(unemployment_rate,week_date)%>%
right_join(df,by="week_date")
df_census=df%>%
left_join(philly_tract_data,by="GEOID")
df_census_sf=df_census%>%
left_join(philly_tract_sf,by="GEOID")
colnames(df_final)
#calculate rent by month and tract
rent_by_month_tract=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))
colnames(df_final)
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y)
View(df_final)
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y)
View(phillyrental_proj_1923)
#calculate rent by month and tract
rent_by_month_tract=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date,NEIGHBORHOOD)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y,NEIGHBORHOOD)
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y,NEIGHBORHOOD.y)
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))
View(df_final)
View(rent_by_month_tract)
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y)
df_final$evibypop=df_final$filings_avg/df_final$total_pop
set.seed(123)
n <- nrow(df_final)
# 70% training, 30% testing
train_indices <- sample(1:n, size = 0.7 * n)
train_data <- df_final[train_indices, ]
test_data <- df_final[-train_indices, ]
colnames(df_final)
model1=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.x+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian,data=df_final)
model1=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian,data=df_final)
summary(model1)
library(VIF)
library(car)
vif(model1)
model1=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian+comcpi,data=df_final)
summary(model1)
vif(model1)
bptest(model1)
library(lmtest)
bptest(model1)
#calculate the RMSE
model_train_1 <- lm(log_price~log_total_livable_area+number_of_bedrooms+number_of_bathrooms+age+interior_condition+quality_grade,data = train_data)
rmse_test_1 <- sqrt(mean((test_data$log_price - test_predictions_1)^2,na.rm = TRUE))
#calculate the RMSE
model_train_1 <- lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian+comcpi,data = train_data)
test_predictions_1 <- predict(model_train_1, newdata = test_data)
rmse_test_1 <- sqrt(mean((test_data$log_price - test_predictions_1)^2,na.rm = TRUE))
rmse_train_1 <- summary(model_train_1)$sigma
plot(model1)
View(df_final)
test=df_final%>%
filter(GEOID=="42101000101")%>%
select(filings_avg)
View(test)
test=df_census_sf%>%
filter(GEOID=="42101000101")%>%
select(filings_avg,week_date)
View(test)
View(df)
df=read.csv(here("data/philadelphia_weekly_2020_2021 (1).csv"))
df$week_date <- my(df$month)
View(df)
test=df%>%
filter(GEOID=="42101000101")%>%
```
test=df%>%
filter(GEOID=="42101000101")
View(test)
df=read.csv(here("data/philadelphia_monthly_2020_2021.csv"))
df$week_date <- my(df$month)
df$first_of_month=floor_date(df$week_date,"month")
summary(df)
df$quarter=quarter(df$week_date)
df$year=year(df$week_date)
df$yearqu=paste0(df$year, df$quarter)
wage_data$yearqu=paste0(wage_data$year,wage_data$qtr)
df=wage_data%>%
select(yearqu,avg_wkly_wage)%>%
right_join(df,by="yearqu")
food=read.csv(here('data/food.csv'))
electricity=read.csv(here('data/electricity.csv'))
commodities=read.csv(here('data/commodities.csv'))
#merge with electricity cpi
df$month=month(df$week_date)
electricity$month=as.numeric(gsub("M","",electricity$Period))
df$yearm=paste0(df$year,df$month)
electricity$yearm=paste0(electricity$Year,electricity$month)
df=electricity%>%
mutate(electricitycpi=Value)%>%
select(yearm,electricitycpi)%>%
right_join(df,by="yearm")
#merge with food cpi
food$first_of_month=ym(food$Label)
df=food%>%
mutate(foodcpi=Value)%>%
select(first_of_month,foodcpi)%>%
right_join(df, by="first_of_month")
df=df%>%
arrange(week_date)%>%
fill(foodcpi, .direction = "up")
#merge with commodities cpi
commodities = commodities %>%
mutate(
comcpi = Value,
half_year_date = case_when(
Period == "S01" ~ ymd(paste(Year, "01", "01")), # Half 1 -> Jan 1
Period == "S02" ~ ymd(paste(Year, "07", "01"))  # Half 2 -> Jul 1
)
) %>%
select(half_year_date, comcpi)
df = df %>%
left_join(commodities, by = c("first_of_month" = "half_year_date"))
df = df %>%
arrange(week_date) %>%
fill(comcpi, .direction = "down")
unemployment=read.csv("data/unemployment.csv")
unemployment$week_date=ym(unemployment$Label)
df=unemployment%>%
mutate(unemployment_rate=Value)%>%
select(unemployment_rate,week_date)%>%
right_join(df,by="week_date")
df_census=df%>%
left_join(philly_tract_data,by="GEOID")
df_census_sf=df_census%>%
left_join(philly_tract_sf,by="GEOID")
#calculate rent by month and tract
rent_by_month_tract=phillyrental_proj_1923%>%
st_drop_geometry()%>%
mutate(date=format(DATE_POSTED,"%Y-%m"))%>%
select(GEOID,RENT_PRICE,date,NEIGHBORHOOD)%>%
group_by(GEOID,date)%>%
summarise(median_rent=median(RENT_PRICE))
#merge with eviction data
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_avg,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y)
df_final=df_census_sf%>%
mutate(date=format(week_date,"%Y-%m"))%>%
filter(year(week_date) %in% c(2020:2023))%>%
left_join(rent_by_month_tract,by=c("date","GEOID"))%>%
select(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,
filings_2020,comcpi,total_pop,pct_white,pct_black,pct_asian,
median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,
median_rooms,total_hh,pct_family,median_rent.y)
df_final$evibypop=df_final$filings_2020/df_final$total_pop
model1=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian,data=df_final)
summary(model1)
model1=lm(evibypop~pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian,data=df_final)
summary(model1)
vif(model1)
bptest(model1)
model2=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+pct_white+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+aggregate_rooms+pct_family+total_hh+pct_black+pct_asian+comcpi,data=df_final)
model2=lm(evibypop~median_rent.y+foodcpi+electricitycpi+avg_wkly_wage+median_rent.y+median_hh_income+pct_renter+unemployment_rate+median_year_built_renter+pct_family+pct_black+pct_asian+comcpi,data=df_final)
vif(model2)
summary(model2)
neighborhood_folder <- here("data", "philadelphia-neighborhoods")
neighborhood_path   <- file.path(neighborhood_folder, "philadelphia-neighborhoods.shp")
# Read the shapefile
philly_neighborhoods <- st_read(neighborhood_path, quiet = TRUE)
head(philly_neighborhoods)
philly_neighborhoods=st_transform(crs=32618)
philly_neighborhoods=st_transform(philly_neighborhoods, crs=32618)
#convert census tract into points
census_points=st_centroid(df_census_sf)
View(df_census_sf)
#convert census tract into points
df_census_sf.test=st_cast(df_census_sf, "POLYGON")
st_crs(df_census_sf)
View(df_census_sf)
#convert census tract into points
df_census_sf=set.crs(df_census_sf,crs=32618)
cpi_data <- data.frame(
year = 2009:2013,
cpi = c(
214.537,  # 2009
218.056,  # 2010
224.939,  # 2011
229.594,  # 2012
232.957  # 2013
)
)
# Set base year for adjustment (2023 dollars)
base_year <- 2013
base_cpi <- cpi_data$cpi[cpi_data$year == base_year]
# Calculate inflation multipliers (relative to 2023)
cpi_data <- cpi_data %>%
mutate(
inflation_multiplier = base_cpi / cpi,
cumulative_inflation = ((base_cpi / cpi) - 1) * 100
)
# Merge CPI data
phillyrental_proj <- phillyrental_proj %>%
mutate(year = year(sale_date)) %>%
left_join(cpi_data %>% select(year, cpi), by = "year")
View(phillyrental_proj_1923)
# Merge CPI data
phillyrental_proj_1923.test <- phillyrental_proj_1923 %>%
mutate(year = year(DATE_POSTED)) %>%
left_join(cpi_data %>% select(year, cpi), by = "year")
# Adjust prices for inflation
phl_sales_res_1923 <- phillyrental_proj_1923.test %>%
mutate(
sale_price_nominal = sale_price,           # Keep original nominal price
sale_price = sale_price * (base_cpi / cpi) # Convert to 2023 dollars (real price)
)
cpi_data <- data.frame(
year = 2019:2023,
cpi = c(255.657, 258.811, 270.970, 292.655, 304.127)
)
# Set base year for adjustment (2023 dollars)
base_year <- 2023
base_cpi <- cpi_data$cpi[cpi_data$year == base_year]
# Calculate inflation multipliers (relative to 2023)
cpi_data <- cpi_data %>%
mutate(
inflation_multiplier = base_cpi / cpi,
cumulative_inflation = ((base_cpi / cpi) - 1) * 100
)
# Merge CPI data
phillyrental_proj_1923.test <- phillyrental_proj_1923 %>%
mutate(year = year(DATE_POSTED)) %>%
left_join(cpi_data %>% select(year, cpi), by = "year")
# Adjust prices for inflation
phl_sales_res_1923 <- phillyrental_proj_1923.test %>%
mutate(
sale_price_nominal = RENT_PRICE,           # Keep original nominal price
sale_price = RENT_PRICE * (base_cpi / cpi) # Convert to 2023 dollars (real price)
)
View(phl_sales_res_1923)
phl_sales_res_1923 = phl_sales_res_1923 %>%
st_join(philly_neighborhoods,join = st_within())
phl_sales_res_1923 = phl_sales_res_1923 %>%
st_join(philly_neighborhoods,join = st_within)
rent=phl_sales_res_1923%>%
group_by(NEIGHBORHOOD)%>%
summarise(median=median(sale_price))
View(rent)
View(philly_neighborhoods)
View(phillyrental_proj_1923)
View(phl_sales_res_1923)
rent=phl_sales_res_1923%>%
group_by(MAPNAME)%>%
summarise(median=median(sale_price))
rentshp=rent%>%
left_join(NEIGHBORHOOD,by=="MAPNAME")
View(rent)
rentshp=rent%>%
left_join(philly_neighborhoods,by=="MAPNAME")
rentshp=rent%>%
st_drop_geometry()
rentshp=rent%>%
st_drop_geometry()%>%
left_join(philly_neighborhoods,by=="MAPNAME")
rentshp=rent%>%
st_drop_geometry()%>%
left_join(philly_neighborhoods,by="MAPNAME")
View(rentshp)
st_write(rentshp,"C:/Users/Tim Wen/Desktop/CPLN5010/rent.shp")
