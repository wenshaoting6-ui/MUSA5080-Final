hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt2=ggplot(df_2020Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2020Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt3=ggplot(df_2021Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2021Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt4=ggplot(df_2022Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2022Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt5=ggplot(df_2023Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2023Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt6=ggplot(df_2024Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2024Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt7=ggplot(df_2025Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2025Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
library(ggpubr)
ggarrange(plt1, plt2, plt3,plt4,plt5,plt6,plt7, ncol = 4, nrow = 2, align = 'h')
windows(width = 15, height =5 )
plt1+plt2+plt3+plt4+plt5
# Calculate the median / mean to plot
df$year=year(df$week_date)
df$yearmonth <- ym(format(df$week_date, "%Y-%m"))
filings_median <- median(df$filings_avg, na.rm = TRUE)
ggplot(df) +
geom_col(aes(x =yearmonth , y = filings_avg),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df$yearmonth),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(title = "Weekly Average Eviction Filings",
subtitle = "For Philadelphia Residential Properties in 2023-2024",
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
df$month=month(df$week_date)
df_2020=df%>%
filter(year==2020)
df_1619Q <- df_2020sum1916 %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_1619Q=df_1619Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2020Q <- df_2020sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2020Q=df_2020Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2021Q <- df_2021sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2021Q=df_2021Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2022Q <- df_2022sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2022Q=df_2022Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2023Q <- df_2023sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2023Q=df_2023Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2024Q <- df_2024sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2024Q=df_2024Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
df_2025Q <- df_2025sum %>%
mutate(q = case_when(
month %in% c(1, 2, 3) ~ 1,
month %in% c(4, 5, 6) ~ 2,
month %in% c(7, 8, 9) ~ 3,
month %in% c(10, 11, 12) ~ 4
))
df_2025Q=df_2025Q%>%
group_by(q)%>%
summarise(sum=sum(sum))
plt1=ggplot(df_1619Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_1619Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt2=ggplot(df_2020Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2020Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt3=ggplot(df_2021Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2021Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt4=ggplot(df_2022Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2022Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt5=ggplot(df_2023Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2023Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt6=ggplot(df_2024Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2024Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
plt7=ggplot(df_2025Q) +
geom_col(aes(x =q , y = sum),
fill = "darkseagreen3", color = "black") +
geom_hline(yintercept = filings_median, linetype = 5) +
annotate("text",
x = max(df_2025Q$q),
y = filings_median,
label = paste("Median:", round(filings_median, 1)),
hjust = 1, vjust = -0.5,
color = "black",
size = 3) +
labs(
x = "Week",
y = "Average Filings") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold")
)
library(ggpubr)
ggarrange(plt1, plt2, plt3,plt4,plt5,plt6,plt7, ncol = 4, nrow = 2, align = 'h')
ggarrange(plt1, plt2, plt3,plt4,plt5,plt6,plt7, ncol = 4, nrow = 2, align = 'h')
file_list <- list.files(
path = "/data",
pattern = "Philadelphia County.*\\.csv$", # Matches files containing "Philadelphia County" and ending in ".xlsx"
full.names = TRUE
)
file_list <- list.files(
path = "\data",
file_list <- list.files(
path = "/data",
pattern = "Philadelphia County.*\\.csv$", # Matches files containing "Philadelphia County" and ending in ".xlsx"
full.names = TRUE
)
file_list <- list.files(
path = "/data",
pattern = ".q1-q4 42101 Philadelphia County, Pennsylvania.csv", # Matches files containing "Philadelphia County" and ending in ".xlsx"
full.names = TRUE
)
file_list <- list.files(
path = "data",
pattern = ".q1-q4 42101 Philadelphia County, Pennsylvania.csv", # Matches files containing "Philadelphia County" and ending in ".xlsx"
full.names = TRUE
)
all_data <- file_list %>%
set_names(2015) %>%
map_df(~ read_csv(.x, sheet = 1L), .id = "source_file")%>%
filter(own_title="Total Covered")
all_data <- file_list %>%
set_names(2015) %>%
map_df(~ read_csv(.x), .id = "source_file")%>%
filter(own_title="Total Covered")
all_data <- file_list %>%
set_names(2015) %>%
map_df(~ read_csv(.x), .id = "source_file")%>%
filter(own_title=="Total Covered")
View(all_data)
all_data <- file_list %>%
set_names() %>%
map_df(~ read_csv(.x), .id = "source_file")%>%
filter(own_title=="Total Covered")
View(all_data)
wage_data <- file_list %>%
set_names() %>%
map_df(~ read_csv(.x), .id = "source_file")%>%
filter(own_title=="Total Covered")%>%
select(year,qtr,avg_weekly_wage)
wage_data <- file_list %>%
set_names() %>%
map_df(~ read_csv(.x), .id = "source_file")%>%
filter(own_title=="Total Covered")%>%
select(year,qtr,avg_wkly_wage)
View(wage_data)
View(df)
df$quarter=quarter(df$week_date)
View(df)
df$yearqu=c(df$year,df$quarter)
df$yearqu=c("df$year,df$quarter")
df$yearqu=c(`df$year,df$quarter`)
df$yearqu=paste0(df$year, df$quarter)
wage_data$yearqu=paste0(wage_data$year,wage_data$qtr)
df.test=df%>%
left_join(wage_data,by=yearqu)
wage_data$yearqu=paste0(wage_data$year,wage_data$qtr)
df.test=df%>%
left_join(wage_data,by=yearqu)
df.test=df%>%
left_join(wage_data,by="yearqu")
View(df.test)
df=df%>%
left_join(wage_data,by="yearqu")
food=read.csv(here('data/food.csv'))
energy=read.csv(here('data/energy.csv'))
electricity=read.csv(here('data/electricity.csv'))
commodities=read.csv(here('data/commdities.csv'))
commodities=read.csv(here('data/commodities.csv'))
View(commodities)
View(food)
foodtest=rep(row.names(food),each=2)
foodtest=data.frame(rep(row.names(food),each=2))
View(foodtest)
foodtest=data.frame(rep(food,each=2))
View(foodtest)
foodtest=data.frame(rep(row(food),each=2))
View(foodtest)
# Get weather from Philadelphia International Airport (KPHL)
# This covers Q4 2024: October 1 - December 31
weather_data <- riem_measures(
station = "PHL",  # Philadelphia International Airport
date_start = "2024-10-01",
date_end = "2024-12-31"
)
# Core tidyverse
library(tidyverse)
library(lubridate)
# Spatial data
library(sf)
library(tigris)
# Census data
library(tidycensus)
# Weather data
library(riem)  # For Philadelphia weather from ASOS stations
# Visualization
library(viridis)
library(gridExtra)
library(knitr)
library(kableExtra)
# here!
library(here)
#Knearest distance
library(FNN)
# Get rid of scientific notation. We gotta look good!
options(scipen = 999)
Sys.setlocale("LC_TIME", "English_United States")
# Get weather from Philadelphia International Airport (KPHL)
# This covers Q4 2024: October 1 - December 31
weather_data <- riem_measures(
station = "PHL",  # Philadelphia International Airport
date_start = "2024-10-01",
date_end = "2024-12-31"
)
# Process weather data
weather_processed <- weather_data %>%
mutate(
interval60 = floor_date(valid, unit = "hour"),
Temperature = tmpf,  # Temperature in Fahrenheit
Precipitation = ifelse(is.na(p01i), 0, p01i),  # Hourly precip in inches
Wind_Speed = sknt  # Wind speed in knots
) %>%
select(interval60, Temperature, Precipitation, Wind_Speed) %>%
distinct()
# Check for missing hours and interpolate if needed
weather_complete <- weather_processed %>%
complete(interval60 = seq(min(interval60), max(interval60), by = "hour")) %>%
fill(Temperature, Precipitation, Wind_Speed, .direction = "down")
# Look at the weather
summary(weather_complete %>% select(Temperature, Precipitation, Wind_Speed))
View(weather_processed)
View(weather_data)
foodtest=data.frame(year=c(2015:2023))
foodtest$month=month(foodtest$year)
food$Label=ym(food$Label)
food$month=month(food$label)
food$month=month(food$Label)
View(df)
food$first_of_month=ym(food$Label)
food$first_of_month=ymd(food$Label)
View(energy)
View(electricity)
electricity$first_of_month=ymd(food$Label)
View(commodities)
df.test=df%>%
left_join(electricity,by="first_of_month")
View(df.test)
electricity$first_of_month=ym(food$Label)
electricity$first_of_month=as.Date(food$Label)
electricity$month=gsub("M0","",electricity$Period)
electricity$month=gsub("M","",electricity$Period)
electricity$month=as.numeric(gsub("M","",electricity$Period))
df$yearmonth
df$yearm=paste0(df$year.x,df$month)
electricity$yearm=paste0(electricity$Year,electricity$month)
df.test=df%>%
left_join(electricity,by="yearm")
df=df%>%
left_join(electricity,by="yearm")
df$electricitycpi=df$Value
