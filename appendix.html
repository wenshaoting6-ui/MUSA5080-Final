<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Technical Appendix</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="appendix_files/libs/clipboard/clipboard.min.js"></script>
<script src="appendix_files/libs/quarto-html/quarto.js"></script>
<script src="appendix_files/libs/quarto-html/popper.min.js"></script>
<script src="appendix_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="appendix_files/libs/quarto-html/anchor.min.js"></script>
<link href="appendix_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="appendix_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="appendix_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="appendix_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="appendix_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link active" data-scroll-target="#the-problem">THE PROBLEM</a>
  <ul class="collapse">
  <li><a href="#load-library" id="toc-load-library" class="nav-link" data-scroll-target="#load-library">Load Library</a></li>
  <li><a href="#philadelphia-shapefile" id="toc-philadelphia-shapefile" class="nav-link" data-scroll-target="#philadelphia-shapefile">Philadelphia shapefile</a></li>
  <li><a href="#census-data-collected" id="toc-census-data-collected" class="nav-link" data-scroll-target="#census-data-collected">census data collected</a></li>
  <li><a href="#dewey-rental-data" id="toc-dewey-rental-data" class="nav-link" data-scroll-target="#dewey-rental-data">Dewey rental data</a></li>
  <li><a href="#load-quartly-wage-data" id="toc-load-quartly-wage-data" class="nav-link" data-scroll-target="#load-quartly-wage-data">Load quartly wage data</a></li>
  <li><a href="#merge-wage-data-with-evictation-data" id="toc-merge-wage-data-with-evictation-data" class="nav-link" data-scroll-target="#merge-wage-data-with-evictation-data">Merge wage data with evictation data</a></li>
  <li><a href="#merge-with-different-cpi-and-unemployment-rate-per-month-in-philadelphia" id="toc-merge-with-different-cpi-and-unemployment-rate-per-month-in-philadelphia" class="nav-link" data-scroll-target="#merge-with-different-cpi-and-unemployment-rate-per-month-in-philadelphia">Merge with different CPI and unemployment rate per month in Philadelphia</a></li>
  <li><a href="#merge-with-unemployment-data" id="toc-merge-with-unemployment-data" class="nav-link" data-scroll-target="#merge-with-unemployment-data">Merge with unemployment data</a></li>
  <li><a href="#merge-with-census-data" id="toc-merge-with-census-data" class="nav-link" data-scroll-target="#merge-with-census-data">Merge with census data</a></li>
  <li><a href="#merge-with-neighborhood-data" id="toc-merge-with-neighborhood-data" class="nav-link" data-scroll-target="#merge-with-neighborhood-data">Merge with neighborhood data</a></li>
  <li><a href="#merge-with-rent-data" id="toc-merge-with-rent-data" class="nav-link" data-scroll-target="#merge-with-rent-data">Merge with rent data</a></li>
  <li><a href="#commercial-and-office-points-of-interests-amenitiesalternative-in-the-next-section-if-you-do-not-want-to-download-pbf-data" id="toc-commercial-and-office-points-of-interests-amenitiesalternative-in-the-next-section-if-you-do-not-want-to-download-pbf-data" class="nav-link" data-scroll-target="#commercial-and-office-points-of-interests-amenitiesalternative-in-the-next-section-if-you-do-not-want-to-download-pbf-data">Commercial and office points of interests (Amenities)(alternative in the next section if you do not want to download pbf data)</a></li>
  <li><a href="#alternative-filtered-poi-if-you-donot-want-to-download-osm-data" id="toc-alternative-filtered-poi-if-you-donot-want-to-download-osm-data" class="nav-link" data-scroll-target="#alternative-filtered-poi-if-you-donot-want-to-download-osm-data">Alternative: filtered POI if you donot want to download osm data</a></li>
  <li><a href="#kernel-density-rasters-economic-activities-density" id="toc-kernel-density-rasters-economic-activities-density" class="nav-link" data-scroll-target="#kernel-density-rasters-economic-activities-density">Kernel Density Rasters (Economic activities density)</a></li>
  <li><a href="#final-data-frame" id="toc-final-data-frame" class="nav-link" data-scroll-target="#final-data-frame">Final data frame</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">EXPLORATORY DATA ANALYSIS</a>
  <ul class="collapse">
  <li><a href="#distribution-of-eviction-counts" id="toc-distribution-of-eviction-counts" class="nav-link" data-scroll-target="#distribution-of-eviction-counts">Distribution of eviction counts</a></li>
  <li><a href="#monthly-eviction-filings-from-2020-2023" id="toc-monthly-eviction-filings-from-2020-2023" class="nav-link" data-scroll-target="#monthly-eviction-filings-from-2020-2023">Monthly Eviction Filings from 2020-2023</a></li>
  <li><a href="#monthly-eviction-filings-by-year" id="toc-monthly-eviction-filings-by-year" class="nav-link" data-scroll-target="#monthly-eviction-filings-by-year">Monthly Eviction Filings by Year</a></li>
  <li><a href="#eviction-filings-by-month-across-years" id="toc-eviction-filings-by-month-across-years" class="nav-link" data-scroll-target="#eviction-filings-by-month-across-years">Eviction Filings by Month Across Years</a></li>
  <li><a href="#eviction-filings-by-quarter-across-years" id="toc-eviction-filings-by-quarter-across-years" class="nav-link" data-scroll-target="#eviction-filings-by-quarter-across-years">Eviction Filings by Quarter Across Years</a></li>
  <li><a href="#eviction-map-on-census-tract-level-from-2020-2023" id="toc-eviction-map-on-census-tract-level-from-2020-2023" class="nav-link" data-scroll-target="#eviction-map-on-census-tract-level-from-2020-2023">Eviction Map on Census Tract level from 2020-2023</a></li>
  <li><a href="#local-morans-i" id="toc-local-morans-i" class="nav-link" data-scroll-target="#local-morans-i">Local Moran’s I</a></li>
  <li><a href="#distance-from-hot-spot" id="toc-distance-from-hot-spot" class="nav-link" data-scroll-target="#distance-from-hot-spot">Distance from hot spot</a></li>
  <li><a href="#eviction-vs-unemployment-rate" id="toc-eviction-vs-unemployment-rate" class="nav-link" data-scroll-target="#eviction-vs-unemployment-rate">Eviction vs Unemployment Rate</a></li>
  <li><a href="#eviction-vs-median-gross-rent" id="toc-eviction-vs-median-gross-rent" class="nav-link" data-scroll-target="#eviction-vs-median-gross-rent">Eviction vs Median Gross Rent</a></li>
  <li><a href="#evication-vs-median-household-income" id="toc-evication-vs-median-household-income" class="nav-link" data-scroll-target="#evication-vs-median-household-income">Evication vs Median Household Income</a></li>
  </ul></li>
  <li><a href="#the-evidence-soluation" id="toc-the-evidence-soluation" class="nav-link" data-scroll-target="#the-evidence-soluation">THE EVIDENCE &amp; SOLUATION</a>
  <ul class="collapse">
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a>
  <ul class="collapse">
  <li><a href="#calculate-eviction-rate-per-population-and-define-outlier-threshold" id="toc-calculate-eviction-rate-per-population-and-define-outlier-threshold" class="nav-link" data-scroll-target="#calculate-eviction-rate-per-population-and-define-outlier-threshold">Calculate eviction rate per population and define outlier threshold</a></li>
  <li><a href="#model-1-ols-regression-of-eviction-rate-on-demographic-characteristics" id="toc-model-1-ols-regression-of-eviction-rate-on-demographic-characteristics" class="nav-link" data-scroll-target="#model-1-ols-regression-of-eviction-rate-on-demographic-characteristics">Model 1: OLS regression of eviction rate on demographic characteristics</a></li>
  <li><a href="#check-multicollinearity-using-vif" id="toc-check-multicollinearity-using-vif" class="nav-link" data-scroll-target="#check-multicollinearity-using-vif">Check multicollinearity using VIF</a></li>
  <li><a href="#breusch-pagan-test-for-heteroskedasticity" id="toc-breusch-pagan-test-for-heteroskedasticity" class="nav-link" data-scroll-target="#breusch-pagan-test-for-heteroskedasticity">Breusch-Pagan test for heteroskedasticity</a></li>
  <li><a href="#model-1-negative-binomial-regression-with-population-offset-and-rmse-calculation" id="toc-model-1-negative-binomial-regression-with-population-offset-and-rmse-calculation" class="nav-link" data-scroll-target="#model-1-negative-binomial-regression-with-population-offset-and-rmse-calculation">Model 1: Negative binomial regression with population offset and RMSE calculation</a></li>
  <li><a href="#model-2-ols-regression-adding-economic-indicators-rent-cpi-wages" id="toc-model-2-ols-regression-adding-economic-indicators-rent-cpi-wages" class="nav-link" data-scroll-target="#model-2-ols-regression-adding-economic-indicators-rent-cpi-wages">Model 2: OLS regression adding economic indicators (rent, CPI, wages)</a></li>
  <li><a href="#check-multicollinearity-for-model-2" id="toc-check-multicollinearity-for-model-2" class="nav-link" data-scroll-target="#check-multicollinearity-for-model-2">Check multicollinearity for Model 2</a></li>
  <li><a href="#breusch-pagan-test-for-heteroskedasticity-in-model-2" id="toc-breusch-pagan-test-for-heteroskedasticity-in-model-2" class="nav-link" data-scroll-target="#breusch-pagan-test-for-heteroskedasticity-in-model-2">Breusch-Pagan test for heteroskedasticity in Model 2</a></li>
  <li><a href="#model-2-negative-binomial-regression-with-economic-indicators-and-rmse-calculation" id="toc-model-2-negative-binomial-regression-with-economic-indicators-and-rmse-calculation" class="nav-link" data-scroll-target="#model-2-negative-binomial-regression-with-economic-indicators-and-rmse-calculation">Model 2: Negative binomial regression with economic indicators and RMSE calculation</a></li>
  <li><a href="#model-3-ols-regression-with-income-quantiles-as-categorical-variable" id="toc-model-3-ols-regression-with-income-quantiles-as-categorical-variable" class="nav-link" data-scroll-target="#model-3-ols-regression-with-income-quantiles-as-categorical-variable">Model 3: OLS regression with income quantiles as categorical variable</a></li>
  <li><a href="#check-multicollinearity-for-model-3" id="toc-check-multicollinearity-for-model-3" class="nav-link" data-scroll-target="#check-multicollinearity-for-model-3">Check multicollinearity for Model 3</a></li>
  <li><a href="#breusch-pagan-test-for-heteroskedasticity-in-model-3" id="toc-breusch-pagan-test-for-heteroskedasticity-in-model-3" class="nav-link" data-scroll-target="#breusch-pagan-test-for-heteroskedasticity-in-model-3">Breusch-Pagan test for heteroskedasticity in Model 3</a></li>
  <li><a href="#model-3-negative-binomial-regression-with-year-fixed-effects-income-quantiles-and-moratorium-indicator" id="toc-model-3-negative-binomial-regression-with-year-fixed-effects-income-quantiles-and-moratorium-indicator" class="nav-link" data-scroll-target="#model-3-negative-binomial-regression-with-year-fixed-effects-income-quantiles-and-moratorium-indicator">Model 3: Negative binomial regression with year fixed effects, income quantiles, and moratorium indicator</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#the-implementation" id="toc-the-implementation" class="nav-link" data-scroll-target="#the-implementation">THE IMPLEMENTATION</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Technical Appendix</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="the-problem" class="level1">
<h1>THE PROBLEM</h1>
<p>Eviction is a serious issue; it can lead to housing instability, homelessness, and long-term negative health outcomes. Eviction is a cyclical event that could perpetuate poverty and community disinvestment. The more evictions that happen in a neighborhood, the higher the chance it will continue to experience the same issue.</p>
<p>Some of the main priority groups are low-income renters, households that experience housing burden, and areas with high unemployment rates. The issue our team is trying to look at is the Eviction problem across Philadelphia County at the census tract level. We have collected all the housing eviction data from Eviction Lab Philadelphia tracking.</p>
<p>Our model is trying to look at various predictors that may contribute to the issue of housing eviction and has a tool that would better predict where the next eviction cold spot is. We hope this tool could further inform policymakers to target potential eviction spots in advance and distribute resources to ensure everyone has a safe home to stay.</p>
<p>Some of the tangible actions that we wish to see include emergency rental assistance funds before the actual evictions occur and identifying neighborhoods for proactive tenant outreach programs to prevent eviction from happening in the first place.</p>
<section id="load-library" class="level3">
<h3 class="anchored" data-anchor-id="load-library">Load Library</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidycensus' was built under R version 4.3.3</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   4.0.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at C:/Users/Tim Wen/Documents/GitHub/MUSA5080-Final</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>To enable caching of data, set `options(tigris_use_cache = TRUE)`
in your R script or .Rprofile.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.data' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.univar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.univar' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.univar 3.1-2
Loading required package: spatstat.geom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.geom' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.geom 3.3-6
Loading required package: spatstat.random</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.random' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.random 3.3-3
Loading required package: spatstat.explore</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.explore' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme

Attaching package: 'nlme'

The following object is masked from 'package:dplyr':

    collapse

spatstat.explore 3.4-2
Loading required package: spatstat.model</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.model' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart
spatstat.model 3.3-5
Loading required package: spatstat.linnet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spatstat.linnet' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.linnet 3.2-5

spatstat 3.3-2 
For an introduction to spatstat, type 'beginner' </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'terra' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.83

Attaching package: 'terra'

The following objects are masked from 'package:spatstat.geom':

    area, delaunay, is.empty, rescale, rotate, shift, where.max,
    where.min

The following object is masked from 'package:tigris':

    blocks

The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'arrow' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'arrow'

The following object is masked from 'package:terra':

    buffer

The following object is masked from 'package:lubridate':

    duration

The following object is masked from 'package:utils':

    timestamp</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'car' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'carData' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'

The following object is masked from 'package:spatstat.model':

    bc

The following object is masked from 'package:spatstat.geom':

    ellipse

The following object is masked from 'package:dplyr':

    recode

The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lmtest' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo

Attaching package: 'zoo'

The following object is masked from 'package:terra':

    time&lt;-

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spdep' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spData' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggpubr'

The following object is masked from 'package:terra':

    rotate

The following objects are masked from 'package:spatstat.geom':

    border, rotate</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'cowplot'

The following object is masked from 'package:ggpubr':

    get_legend

The following object is masked from 'package:lubridate':

    stamp</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/philadelphia_monthly_2020_2021.csv"</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>week_date <span class="ot">&lt;-</span> <span class="fu">my</span>(df<span class="sc">$</span>month)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>first_of_month<span class="ot">=</span><span class="fu">floor_date</span>(df<span class="sc">$</span>week_date,<span class="st">"month"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     type              GEOID           racial_majority       month          
 Length:29039       Length:29039       Length:29039       Length:29039      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
  filings_2020      filings_avg     filings_avg_prepandemic_baseline
 Min.   :  0.000   Min.   : 0.000   Min.   : 0.000                  
 1st Qu.:  0.000   1st Qu.: 0.500   1st Qu.: 1.250                  
 Median :  1.000   Median : 2.000   Median : 3.250                  
 Mean   :  2.286   Mean   : 2.675   Mean   : 4.284                  
 3rd Qu.:  3.000   3rd Qu.: 4.000   3rd Qu.: 6.000                  
 Max.   :694.000   Max.   :34.500   Max.   :40.000                  
 last_updated         week_date          first_of_month      
 Length:29039       Min.   :2020-01-01   Min.   :2020-01-01  
 Class :character   1st Qu.:2021-06-01   1st Qu.:2021-06-01  
 Mode  :character   Median :2022-12-01   Median :2022-12-01  
                    Mean   :2022-12-01   Mean   :2022-12-01  
                    3rd Qu.:2024-06-01   3rd Qu.:2024-06-01  
                    Max.   :2025-11-01   Max.   :2025-11-01  </code></pre>
</div>
</div>
</section>
<section id="philadelphia-shapefile" class="level3">
<h3 class="anchored" data-anchor-id="philadelphia-shapefile">Philadelphia shapefile</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>census_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"Philly Census"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>census_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(census_path, <span class="st">"philly_tract.shp"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>philly_tract_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(census_shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ACS Variables Collected:</p>
<ul>
<li>Median gross rent: (B25064)</li>
<li>Race: (B02001)</li>
<li>Median household income: (B19013)</li>
<li>% of Renter: (B25003)</li>
<li>Year Built(renter): (B25036)</li>
<li>Number of Room: (B25017)</li>
<li>Room Per Household: (B25020)</li>
<li>Family Structure: (B11001)</li>
<li>Unemployment in labor force: (C18120)</li>
<li>Gross Rent as a Percentage of Household Income: (B25070)</li>
</ul>
</section>
<section id="census-data-collected" class="level3">
<h3 class="anchored" data-anchor-id="census-data-collected">census data collected</h3>
</section>
<section id="dewey-rental-data" class="level3">
<h3 class="anchored" data-anchor-id="dewey-rental-data">Dewey rental data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input data</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>folder_path <span class="ot">&lt;-</span> <span class="st">"data/rental-in-philly"</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>all_parquet_files <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sources =</span> folder_path, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"parquet"</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> all_parquet_files <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">#reproject it</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>rental_shp<span class="ot">=</span>combined_df<span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, <span class="st">"LATITUDE"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">#input city limit data  </span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>api_url <span class="ot">&lt;-</span> <span class="st">"https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/City_Limits/FeatureServer/0/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>city_limits_data <span class="ot">&lt;-</span> <span class="fu">st_read</span>(api_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `OGRGeoJSON' from data source 
  `https://services.arcgis.com/fLeGjb7u4uXqeF9q/arcgis/rest/services/City_Limits/FeatureServer/0/query?outFields=*&amp;where=1%3D1&amp;f=geojson' 
  using driver `GeoJSON'
Simple feature collection with 1 feature and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -75.28031 ymin: 39.86747 xmax: -74.95575 ymax: 40.13793
Geodetic CRS:  WGS 84</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rental_shp_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(rental_shp, <span class="at">crs =</span> <span class="dv">32618</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>city_limits_data_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(city_limits_data, <span class="at">crs =</span> <span class="dv">32618</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#filter to philadelphia</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>phillyrental_proj <span class="ot">&lt;-</span> <span class="fu">st_filter</span>(rental_shp_proj, city_limits_data_proj, <span class="at">.pred =</span> st_within)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#filter to different times</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>phillyrental_proj_1923<span class="ot">=</span>phillyrental_proj<span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">year</span>(DATE_POSTED) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>phillyrental_proj_1619<span class="ot">=</span>phillyrental_proj<span class="sc">%&gt;%</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">year</span>(DATE_POSTED) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2019</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>philly_tract_sf<span class="ot">=</span><span class="fu">st_transform</span>(philly_tract_sf,<span class="at">crs=</span><span class="dv">32618</span>)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="co">#merge with census tract</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>phillyrental_proj_1923<span class="ot">=</span>phillyrental_proj_1923<span class="sc">%&gt;%</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_tract_sf,<span class="at">join =</span> st_within)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>phillyrental_proj_1619<span class="ot">=</span>phillyrental_proj_1619<span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(philly_tract_sf,<span class="at">join =</span> st_within)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-quartly-wage-data" class="level3">
<h3 class="anchored" data-anchor-id="load-quartly-wage-data">Load quartly wage data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"data"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">".q1-q4 42101 Philadelphia County, Pennsylvania.csv"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>wage_data <span class="ot">&lt;-</span> file_list <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">read_csv</span>(.x), <span class="at">.id =</span> <span class="st">"source_file"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(own_title<span class="sc">==</span><span class="st">"Total Covered"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(year,qtr,avg_wkly_wage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 8220 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8252 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8172 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8192 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8192 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8252 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 8228 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 7984 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 7996 Columns: 47
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(9): industry_code, disclosure_code, area_title, own_title, industry_ti... dbl
(38): area_fips, own_code, agglvl_code, size_code, year, qtr, qtrly_esta...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `oty_taxable_qtrly_wages_chg` -&gt; `oty_taxable_qtrly_wages_chg...42`
• `oty_taxable_qtrly_wages_chg` -&gt; `oty_taxable_qtrly_wages_chg...43`</code></pre>
</div>
</div>
</section>
<section id="merge-wage-data-with-evictation-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-wage-data-with-evictation-data">Merge wage data with evictation data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>quarter<span class="ot">=</span><span class="fu">quarter</span>(df<span class="sc">$</span>week_date)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>year<span class="ot">=</span><span class="fu">year</span>(df<span class="sc">$</span>week_date)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>yearqu<span class="ot">=</span><span class="fu">paste0</span>(df<span class="sc">$</span>year, df<span class="sc">$</span>quarter)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>wage_data<span class="sc">$</span>yearqu<span class="ot">=</span><span class="fu">paste0</span>(wage_data<span class="sc">$</span>year,wage_data<span class="sc">$</span>qtr)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>wage_data<span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(yearqu,avg_wkly_wage)<span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df,<span class="at">by=</span><span class="st">"yearqu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="merge-with-different-cpi-and-unemployment-rate-per-month-in-philadelphia" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-different-cpi-and-unemployment-rate-per-month-in-philadelphia">Merge with different CPI and unemployment rate per month in Philadelphia</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>food<span class="ot">=</span><span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">'data/food.csv'</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>electricity<span class="ot">=</span><span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">'data/electricity.csv'</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>commodities<span class="ot">=</span><span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">'data/commodities.csv'</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#merge with electricity cpi</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>month<span class="ot">=</span><span class="fu">month</span>(df<span class="sc">$</span>week_date)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>electricity<span class="sc">$</span>month<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"M"</span>,<span class="st">""</span>,electricity<span class="sc">$</span>Period))</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>yearm<span class="ot">=</span><span class="fu">paste0</span>(df<span class="sc">$</span>year,df<span class="sc">$</span>month)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>electricity<span class="sc">$</span>yearm<span class="ot">=</span><span class="fu">paste0</span>(electricity<span class="sc">$</span>Year,electricity<span class="sc">$</span>month)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>electricity<span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">electricitycpi=</span>Value)<span class="sc">%&gt;%</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(yearm,electricitycpi)<span class="sc">%&gt;%</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df,<span class="at">by=</span><span class="st">"yearm"</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#merge with food cpi</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>food<span class="sc">$</span>first_of_month<span class="ot">=</span><span class="fu">ym</span>(food<span class="sc">$</span>Label)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>food<span class="sc">%&gt;%</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcpi=</span>Value)<span class="sc">%&gt;%</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(first_of_month,foodcpi)<span class="sc">%&gt;%</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df, <span class="at">by=</span><span class="st">"first_of_month"</span>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df<span class="sc">%&gt;%</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(week_date)<span class="sc">%&gt;%</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(foodcpi, <span class="at">.direction =</span> <span class="st">"up"</span>)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co">#merge with commodities cpi</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>commodities <span class="ot">=</span> commodities <span class="sc">%&gt;%</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">comcpi =</span> Value, </span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">half_year_date =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>      Period <span class="sc">==</span> <span class="st">"S01"</span> <span class="sc">~</span> <span class="fu">ymd</span>(<span class="fu">paste</span>(Year, <span class="st">"01"</span>, <span class="st">"01"</span>)), <span class="co"># Half 1 -&gt; Jan 1</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>      Period <span class="sc">==</span> <span class="st">"S02"</span> <span class="sc">~</span> <span class="fu">ymd</span>(<span class="fu">paste</span>(Year, <span class="st">"07"</span>, <span class="st">"01"</span>))  <span class="co"># Half 2 -&gt; Jul 1</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(half_year_date, comcpi)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(commodities, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"first_of_month"</span> <span class="ot">=</span> <span class="st">"half_year_date"</span>))</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(week_date) <span class="sc">%&gt;%</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(comcpi, <span class="at">.direction =</span> <span class="st">"down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="merge-with-unemployment-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-unemployment-data">Merge with unemployment data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>unemployment<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">"data/unemployment.csv"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>unemployment<span class="sc">$</span>week_date<span class="ot">=</span><span class="fu">ym</span>(unemployment<span class="sc">$</span>Label)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>unemployment<span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unemployment_rate=</span>Value)<span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(unemployment_rate,week_date)<span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df,<span class="at">by=</span><span class="st">"week_date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="merge-with-census-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-census-data">Merge with census data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_census<span class="ot">=</span>df<span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(philly_tract_data,<span class="at">by=</span><span class="st">"GEOID"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>df_census_sf<span class="ot">=</span>philly_tract_sf<span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_census,<span class="at">by=</span><span class="st">"GEOID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="merge-with-neighborhood-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-neighborhood-data">Merge with neighborhood data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>neighborhood_folder <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"philadelphia-neighborhoods"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>neighborhood_path   <span class="ot">&lt;-</span> <span class="fu">file.path</span>(neighborhood_folder, <span class="st">"philadelphia-neighborhoods.shp"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the shapefile</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>philly_neighborhoods <span class="ot">&lt;-</span> <span class="fu">st_read</span>(neighborhood_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>philly_neighborhoods<span class="ot">=</span><span class="fu">st_transform</span>(philly_neighborhoods, <span class="at">crs=</span><span class="dv">32618</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>census_points<span class="ot">=</span><span class="fu">st_centroid</span>(df_census_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_census_sf<span class="ot">=</span><span class="fu">st_transform</span>(df_census_sf,<span class="at">crs=</span><span class="dv">32618</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>census_points<span class="ot">=</span><span class="fu">st_transform</span>(census_points,<span class="at">crs=</span><span class="dv">32618</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>points_joined <span class="ot">&lt;-</span> <span class="fu">st_join</span>(census_points, philly_neighborhoods)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>df_census_sf<span class="ot">=</span><span class="fu">st_join</span>(df_census_sf,philly_neighborhoods)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean MHI for each polygon</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>mean_mhi_by_poly <span class="ot">&lt;-</span> points_joined <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>             </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MAPNAME) <span class="sc">%&gt;%</span>            </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">meanMHI =</span> <span class="fu">mean</span>(median_hh_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the result back to the polygon layer</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>df_census_sf_final <span class="ot">&lt;-</span> df_census_sf <span class="sc">%&gt;%</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_mhi_by_poly, <span class="at">by =</span> <span class="st">"MAPNAME"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify the neighborhood data based on quantile (25%)</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>df_census_sf_final<span class="sc">$</span>MHI_quantile <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  df_census_sf_final<span class="sc">$</span>meanMHI,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">quantile</span>(</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    df_census_sf_final<span class="sc">$</span>meanMHI,</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),   </span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Q1 (lowest)"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4 (highest)"</span>)</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="merge-with-rent-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-rent-data">Merge with rent data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate rent by month and tract</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>rent_by_month_tract<span class="ot">=</span>phillyrental_proj_1923<span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">format</span>(DATE_POSTED,<span class="st">"%Y-%m"</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>rent_by_month_tract<span class="ot">=</span>rent_by_month_tract<span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID,RENT_PRICE,date)<span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID,date)<span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">median_rent=</span><span class="fu">median</span>(RENT_PRICE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'GEOID'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="commercial-and-office-points-of-interests-amenitiesalternative-in-the-next-section-if-you-do-not-want-to-download-pbf-data" class="level3">
<h3 class="anchored" data-anchor-id="commercial-and-office-points-of-interests-amenitiesalternative-in-the-next-section-if-you-do-not-want-to-download-pbf-data">Commercial and office points of interests (Amenities)(alternative in the next section if you do not want to download pbf data)</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># downloading osm data from geofabrik:https://download.geofabrik.de/north-america/us-northeast.html</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#input_pbf &lt;- "the pdf file downloaded from the link above"</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get boundary of Philadelphia County</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>pa_counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"PA"</span>, <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Philadelphia County</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">subset</span>(pa_counties, NAME <span class="sc">==</span> <span class="st">"Philadelphia"</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># read the full OSM PBF (you can select layer types like points, lines, polygons)</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">oe_read</span>(input_pbf, </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">boundary =</span> philly_boundary, </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">boundary_type =</span> <span class="st">"clipsrc"</span>, </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">"points"</span>)  <span class="co"># or "lines" / "multipolygons"</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"shop"</span>,<span class="st">"amenity"</span>,<span class="st">"office"</span>,<span class="st">"historic"</span>,<span class="st">"tourism"</span>,<span class="st">"healthcare"</span>,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">"building"</span>,<span class="st">"leisure"</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(keywords, <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Filter by 'other_tags' ====</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"other_tags"</span> <span class="sc">%in%</span> <span class="fu">names</span>(poi)) {</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  poi<span class="sc">$</span>other_tags <span class="ot">&lt;-</span> <span class="fu">iconv</span>(<span class="fu">as.character</span>(poi<span class="sc">$</span>other_tags), <span class="at">from =</span> <span class="st">""</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  poi<span class="sc">$</span>other_tags[<span class="fu">is.na</span>(poi<span class="sc">$</span>other_tags)] <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  poi_filtered <span class="ot">&lt;-</span> poi <span class="sc">%&gt;%</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(pattern, other_tags, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"filtered POIs found:"</span>, <span class="fu">nrow</span>(poi_filtered), <span class="st">"of"</span>, <span class="fu">nrow</span>(poi), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="alternative-filtered-poi-if-you-donot-want-to-download-osm-data" class="level3">
<h3 class="anchored" data-anchor-id="alternative-filtered-poi-if-you-donot-want-to-download-osm-data">Alternative: filtered POI if you donot want to download osm data</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>poi_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"filtered poi"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>poi_shp_path<span class="ot">=</span><span class="fu">file.path</span>(poi_path, <span class="st">"philadelphia_poi_filtered.shp"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>poi<span class="ot">=</span><span class="fu">st_read</span>(poi_shp_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `philadelphia_poi_filtered' from data source 
  `C:\Users\Tim Wen\Documents\GitHub\MUSA5080-Final\data\filtered poi\philadelphia_poi_filtered.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 11161 features and 10 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.27472 ymin: 39.87383 xmax: -74.95777 ymax: 40.13445
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="kernel-density-rasters-economic-activities-density" class="level3">
<h3 class="anchored" data-anchor-id="kernel-density-rasters-economic-activities-density">Kernel Density Rasters (Economic activities density)</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get boundary of Philadelphia County</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>pa_counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"PA"</span>, <span class="at">year =</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |==                                                                    |   4%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |=========                                                             |  14%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |================                                                      |  24%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |=======================                                               |  34%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |==========================                                            |  38%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |==========================================================            |  84%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Philadelphia County</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">subset</span>(pa_counties, NAME <span class="sc">==</span> <span class="st">"Philadelphia"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>philly_boundary <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(philly_boundary, <span class="dv">3364</span>)  </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poi, <span class="dv">3364</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Prepare point pattern ====</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sf points to spatstat ppp object</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>win <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(philly_boundary))  <span class="co"># window from county boundary</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(poi)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coords[,<span class="dv">1</span>], <span class="at">y =</span> coords[,<span class="dv">2</span>], <span class="at">window =</span> win)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Run Kernel Density Estimation ====</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigma = bandwidth in map units (here, meters)</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>density_map <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(pp, <span class="at">sigma =</span> <span class="dv">300</span><span class="sc">*</span> <span class="fl">3.28084</span>, <span class="at">edge =</span> <span class="cn">TRUE</span>, <span class="at">at =</span> <span class="st">"pixels"</span>,<span class="at">eps =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Convert to raster ====</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>r_Economic <span class="ot">&lt;-</span> <span class="fu">rast</span>(density_map)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(r_Economic) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(philly_boundary)<span class="sc">$</span>proj4string</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>r_Economic <span class="ot">&lt;-</span> <span class="fu">mask</span>(r_Economic, <span class="fu">vect</span>(philly_boundary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="final-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="final-data-frame">Final data frame</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'raster' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sp' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'raster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:nlme':

    getData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#merge with eviction data</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>df_census_sf_final<span class="sc">$</span>KDE <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  r_Economic,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  df_census_sf_final,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> mean,        </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: [extract] transforming vector data to the CRS of the raster</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df_final<span class="ot">=</span>df_census_sf_final<span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">format</span>(week_date,<span class="st">"%Y-%m"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(week_date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span><span class="sc">:</span><span class="dv">2023</span>))<span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rent_by_month_tract,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"date"</span>,<span class="st">"GEOID"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EconKDE =</span> KDE<span class="sc">$</span>lyr<span class="fl">.1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID,unemployment_rate,foodcpi,electricitycpi,avg_wkly_wage,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>         filings_2020,comcpi,total_pop,pct_white,pct_black,pct_asian,</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>         median_hh_income,pct_renter,median_year_built_renter,aggregate_rooms,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>         median_rooms,total_hh,pct_family,median_rent.y,MHI_quantile,week_date,year,EconKDE,pct_rent_burdened)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>EXPLORATORY DATA ANALYSIS</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "GEOID"                    "unemployment_rate"       
 [3] "foodcpi"                  "electricitycpi"          
 [5] "avg_wkly_wage"            "filings_2020"            
 [7] "comcpi"                   "total_pop"               
 [9] "pct_white"                "pct_black"               
[11] "pct_asian"                "median_hh_income"        
[13] "pct_renter"               "median_year_built_renter"
[15] "aggregate_rooms"          "median_rooms"            
[17] "total_hh"                 "pct_family"              
[19] "median_rent.y"            "MHI_quantile"            
[21] "week_date"                "year"                    
[23] "EconKDE"                  "pct_rent_burdened"       
[25] "geometry"                </code></pre>
</div>
</div>
<section id="distribution-of-eviction-counts" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-eviction-counts">Distribution of eviction counts</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate total filings by tract</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>tract_totals <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(first_of_month) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tract_totals, <span class="fu">aes</span>(<span class="at">x =</span> total_filings)) <span class="sc">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(tract_totals<span class="sc">$</span>total_filings, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">by =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Eviction Filings by Census Tract (2020-2023)"</span>,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Most tracts have fewer than 200 total filings; a few have extremely high counts"</span>,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Eviction Filings"</span>,</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Census Tracts"</span>,</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Eviction Lab"</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Most of the tracts have fillings less than 200. There are some tracts that has more than 500 fillings.</p>
</section>
<section id="monthly-eviction-filings-from-2020-2023" class="level3">
<h3 class="anchored" data-anchor-id="monthly-eviction-filings-from-2020-2023">Monthly Eviction Filings from 2020-2023</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate total filings by month across all years</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>monthly_totals <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(first_of_month),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(first_of_month)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(first_of_month) <span class="sc">%&gt;%</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram/bar chart</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_totals, <span class="fu">aes</span>(<span class="at">x =</span> first_of_month, <span class="at">y =</span> total_filings)) <span class="sc">+</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">width =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"3 months"</span>,</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b</span><span class="sc">\n</span><span class="st">%Y"</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Eviction Filings in Philadelphia (2020-2023)"</span>,</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Note: COVID-19 moratorium caused near-zero filings in April-June 2020"</span>,</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Eviction Filings"</span>,</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Eviction Lab"</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This figure displays monthly eviction filings in Philadelphia from January 2020 through late 2023. The COVID-19 eviction caused filings to drop to zero from April-June 2020. By mid-2022, eviction filings surged past pre-pandemic levels, peaking in August 2022 before stabilizing around 2023.</p>
</section>
<section id="monthly-eviction-filings-by-year" class="level3">
<h3 class="anchored" data-anchor-id="monthly-eviction-filings-by-year">Monthly Eviction Filings by Year</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by year and month</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>monthly_by_year <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>))</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the data</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(monthly_by_year, <span class="at">n =</span> <span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 3
    year month total_filings
   &lt;dbl&gt; &lt;dbl&gt;         &lt;int&gt;
 1  2020     1          2015
 2  2020     2          1720
 3  2020     3           813
 4  2020     4             0
 5  2020     5             0
 6  2020     6             0
 7  2020     7           198
 8  2020     8           176
 9  2020     9           701
10  2020    10           792
11  2020    11           583
12  2020    12           509
13  2021     1           559
14  2021     2           664
15  2021     3           677
16  2021     4           187
17  2021     5           173
18  2021     6           320
19  2021     7           444
20  2021     8           494
21  2021     9           540
22  2021    10           756
23  2021    11           909
24  2021    12          1031
25  2022     1          1044
26  2022     2           562
27  2022     3           967
28  2022     4           902
29  2022     5          1168
30  2022     6          1246
31  2022     7          1126
32  2022     8          1768
33  2022     9          1631
34  2022    10          1299
35  2022    11          1211
36  2022    12          1366
37  2023     1          1397
38  2023     2          1182
39  2023     3          1354
40  2023     4           892
41  2023     5          1092
42  2023     6          1102
43  2023     7          1051
44  2023     8          1207
45  2023     9           854
46  2023    10          1084
47  2023    11           975
48  2023    12           970</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create plot for each year</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>make_year_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, year_num) {</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  year_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> year_num)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(year_data) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> total_filings), </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> month.abb) <span class="sc">+</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">as.character</span>(year_num),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 4 plots</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>), <span class="sc">~</span><span class="fu">make_year_plot</span>(monthly_by_year, .x))</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange 2x2</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">'hv'</span>)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(combined,</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Monthly Eviction Filings by Year"</span>, </span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">left =</span> <span class="fu">text_grob</span>(<span class="st">"Total Filings"</span>, <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This figure shows monthly eviction filings in Philadelphia from 2020 to 2023. The COVID-19 caused filings to drop to near-zero from April to June 2020. Then it followed a recovery period in the late 2020. In 2022 and 2023, eviction filings are at higher levels. Second half of 2021 and 2022 and 2023 all exceed pre-pandemic patterns and showing seasonal peaks in late summer.</p>
</section>
<section id="eviction-filings-by-month-across-years" class="level3">
<h3 class="anchored" data-anchor-id="eviction-filings-by-month-across-years">Eviction Filings by Month Across Years</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate by year and month</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>monthly_by_year <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>))</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create plot for each month</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>make_month_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, month_num) {</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  month_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">==</span> month_num)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  month_label <span class="ot">&lt;-</span> month.abb[month_num]</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  years_present <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(month_data<span class="sc">$</span>year))</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  year_labels <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">as.character</span>(years_present), <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(month_data) <span class="sc">+</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> total_filings), </span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> year_labels) <span class="sc">+</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> month_label, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 12 plots</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="sc">~</span><span class="fu">make_month_plot</span>(monthly_by_year, .x))</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange 3x4</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="st">'hv'</span>)</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(combined,</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Eviction Filings by Month Across Years"</span>, </span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">left =</span> <span class="fu">text_grob</span>(<span class="st">"Total Filings"</span>, <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is no apparent monthly pattern across these four years.</p>
</section>
<section id="eviction-filings-by-quarter-across-years" class="level3">
<h3 class="anchored" data-anchor-id="eviction-filings-by-quarter-across-years">Eviction Filings by Quarter Across Years</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by year and quarter</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>quarterly_data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(first_of_month),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter =</span> <span class="fu">quarter</span>(first_of_month)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, quarter) <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create plot for each quarter</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>make_quarter_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, quarter_num) {</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  quarter_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(quarter <span class="sc">==</span> quarter_num)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(quarter_data) <span class="sc">+</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> total_filings), </span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Q"</span>, quarter_num), <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 4 plots</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span><span class="fu">make_quarter_plot</span>(quarterly_data, .x))</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange 2x2</span></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> plot_list, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">'hv'</span>)</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(combined,</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Eviction Filings by Quarter (2020-2023)"</span>, </span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">left =</span> <span class="fu">text_grob</span>(<span class="st">"Total Filings"</span>, <span class="at">rot =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="eviction-map-on-census-tract-level-from-2020-2023" class="level3">
<h3 class="anchored" data-anchor-id="eviction-map-on-census-tract-level-from-2020-2023">Eviction Map on Census Tract level from 2020-2023</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate filings by GEOID and year</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>evictions_by_tract_year <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, year) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>))</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># join with census tract geometry</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>evictions_map_data <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(evictions_by_tract_year, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># function to create map for each year</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>make_year_map <span class="ot">&lt;-</span> <span class="cf">function</span>(data, year_num) {</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>  year_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> year_num)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(year_data) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> total_filings), <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"inferno"</span>,</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Filings"</span>,</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.value =</span> <span class="st">"grey90"</span></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">as.character</span>(year_num)) <span class="sc">+</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>),</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a><span class="co"># create 4 maps</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>map_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>), <span class="sc">~</span><span class="fu">make_year_map</span>(evictions_map_data, .x))</span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>combined_maps <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(<span class="at">plotlist =</span> map_list, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>                            <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>)</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(combined_maps,</span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Eviction Filings by Census Tract (2020-2023)"</span>, </span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Eviction hot spots remain spatially persistent across all four years, concentrated in North Philadelphia, West Philadelphia, and parts of Southwest Philadelphia, while Center City and the Far Northeast consistently show lower filing rates. The overall intensity of evictions increased from 2020 to 2023.</p>
</section>
<section id="local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="local-morans-i">Local Moran’s I</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate total filings by tract (across all years or pick one year)</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>evictions_by_tract <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># join to geometry</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>evictions_sf <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(evictions_by_tract, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_filings))</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create spatial weights (queen contiguity)</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>neighbors <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(evictions_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(neighbors, <span class="at">style =</span> <span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate Local Moran's I</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>local_moran <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(evictions_sf<span class="sc">$</span>total_filings, weights, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co"># add results to sf object</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>evictions_sf <span class="ot">&lt;-</span> evictions_sf <span class="sc">%&gt;%</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_i =</span> local_moran[, <span class="dv">1</span>],</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> local_moran[, <span class="dv">5</span>],</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaled_filings =</span> <span class="fu">scale</span>(total_filings),</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scaled =</span> <span class="fu">lag.listw</span>(weights, scaled_filings, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>),</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classify hot/cold spots</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">hotspot_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>      scaled_filings <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scaled <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Hot Spot (High-High)"</span>,</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>      scaled_filings <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scaled <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Cold Spot (Low-Low)"</span>,</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>      scaled_filings <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scaled <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"High-Low Outlier"</span>,</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>      scaled_filings <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scaled <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Low-High Outlier"</span>,</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not Significant"</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="co"># plot LISA map</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(evictions_sf) <span class="sc">+</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> hotspot_type), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Hot Spot (High-High)"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>,</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Cold Spot (Low-Low)"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>,</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"High-Low Outlier"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>,</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Low-High Outlier"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>,</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Cluster Type"</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Eviction Hot Spots and Cold Spots (2023)"</span>,</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Local Moran's I Cluster Analysis"</span>,</span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Hot spots = High evictions surrounded by high evictions"</span></span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The map shows that significant eviction hot spots concentrated in North Philadelphia and some part of West Philadelphia, where high-eviction tracts cluster together. Cold spots appear in South Philadelphia and the Far Northeast, indicating areas where low evictions are surrounded by similarly low eviction rates, while most of the city shows no significant spatial clustering.</p>
</section>
<section id="distance-from-hot-spot" class="level3">
<h3 class="anchored" data-anchor-id="distance-from-hot-spot">Distance from hot spot</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#identify hot spot centroids from LISA analysis above</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>hotspot_tracts <span class="ot">&lt;-</span> evictions_sf <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hotspot_type <span class="sc">==</span> <span class="st">"Hot Spot (High-High)"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>hotspot_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(hotspot_tracts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance from each tract to nearest hot spot</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>all_tracts <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(evictions_by_tract, <span class="at">by =</span> <span class="st">"GEOID"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>tract_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(all_tracts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># distance to nearest hot spot</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>dist_to_hotspot <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(tract_centroids, hotspot_centroids)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>all_tracts<span class="sc">$</span>dist_to_hotspot <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_to_hotspot, <span class="dv">1</span>, min)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>all_tracts<span class="sc">$</span>dist_to_hotspot_km <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_tracts<span class="sc">$</span>dist_to_hotspot) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot distance map</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_tracts) <span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> dist_to_hotspot_km), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Distance</span><span class="sc">\n</span><span class="st">(km)"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hotspot_tracts, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance to Eviction Hot Spots"</span>,</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red outlines = Hot spot tracts"</span>,</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Darker = closer to high-eviction clusters"</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The Far Northeast and South Philadelphia are the most distant from high-eviction clusters, while much of North and West Philadelphia lies within close proximity to hot spots, indicating these areas may be at higher risk of eviction spillover effects.</p>
</section>
<section id="eviction-vs-unemployment-rate" class="level3">
<h3 class="anchored" data-anchor-id="eviction-vs-unemployment-rate">Eviction vs Unemployment Rate</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  <span class="co"># ADD THIS LINE</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployment =</span> <span class="fu">mean</span>(unemployment_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(map_data, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_filings) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(unemployment))</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create tertiles for each variable</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> map_sf <span class="sc">%&gt;%</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">filings_class =</span> <span class="fu">ntile</span>(total_filings, <span class="dv">3</span>),</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemp_class =</span> <span class="fu">ntile</span>(unemployment, <span class="dv">3</span>),</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bi_class =</span> <span class="fu">paste0</span>(unemp_class, <span class="st">"-"</span>, filings_class)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define bivariate color palette</span></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>bivariate_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-1"</span> <span class="ot">=</span> <span class="st">"#e8e8e8"</span>,  <span class="co"># Low unemployment, Low evictions</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-1"</span> <span class="ot">=</span> <span class="st">"#ace4e4"</span>,  <span class="co"># Med unemployment, Low evictions</span></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-1"</span> <span class="ot">=</span> <span class="st">"#5ac8c8"</span>,  <span class="co"># High unemployment, Low evictions</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-2"</span> <span class="ot">=</span> <span class="st">"#dfb0d6"</span>,  <span class="co"># Low unemployment, Med evictions</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-2"</span> <span class="ot">=</span> <span class="st">"#a5add3"</span>,  <span class="co"># Med unemployment, Med evictions</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-2"</span> <span class="ot">=</span> <span class="st">"#5698b9"</span>,  <span class="co"># High unemployment, Med evictions</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-3"</span> <span class="ot">=</span> <span class="st">"#be64ac"</span>,  <span class="co"># Low unemployment, High evictions</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-3"</span> <span class="ot">=</span> <span class="st">"#8c62aa"</span>,  <span class="co"># Med unemployment, High evictions</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-3"</span> <span class="ot">=</span> <span class="st">"#3b4994"</span>   <span class="co"># High unemployment, High evictions</span></span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> philly_tract_sf, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_sf, <span class="fu">aes</span>(<span class="at">fill =</span> bi_class), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors, <span class="at">na.value =</span> <span class="st">"grey90"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Eviction Filings vs Unemployment Rate"</span>,</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Darker purple = High evictions AND high unemployment"</span></span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE LEGEND DATA - this was missing!</span></span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a>legend_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bi_class =</span> <span class="fu">paste0</span>(x, <span class="st">"-"</span>, y))</span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-52"><a href="#cb104-52" aria-hidden="true" tabindex="-1"></a>legend1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(legend_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> bi_class)) <span class="sc">+</span></span>
<span id="cb104-53"><a href="#cb104-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb104-54"><a href="#cb104-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb104-55"><a href="#cb104-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Unemp. →"</span>, <span class="at">y =</span> <span class="st">"Evict. →"</span>) <span class="sc">+</span></span>
<span id="cb104-56"><a href="#cb104-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb104-57"><a href="#cb104-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-58"><a href="#cb104-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb104-59"><a href="#cb104-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))</span>
<span id="cb104-60"><a href="#cb104-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-61"><a href="#cb104-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-62"><a href="#cb104-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-63"><a href="#cb104-63" aria-hidden="true" tabindex="-1"></a>final_plot1 <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb104-64"><a href="#cb104-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(map1, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb104-65"><a href="#cb104-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(legend1, <span class="fl">0.7</span>, <span class="fl">0.05</span>, <span class="fl">0.22</span>, <span class="fl">0.22</span>)</span>
<span id="cb104-66"><a href="#cb104-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-67"><a href="#cb104-67" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This map shows that high concentration of evictions with high unemployment occurs in North Philadelphia and parts of West Philadelphia. These areas are potentially facing economic hardship. Some South Philadelphia tracts show high unemployment but lower evictions, while the Far Northeast shows low values for both measures, suggesting that unemployment alone does not fully explain eviction patterns.</p>
</section>
<section id="eviction-vs-median-gross-rent" class="level3">
<h3 class="anchored" data-anchor-id="eviction-vs-median-gross-rent">Eviction vs Median Gross Rent</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_rent =</span> <span class="fu">first</span>(median_rent.y),</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(map_data, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_filings) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(median_rent))</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create tertiles for each variable</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> map_sf <span class="sc">%&gt;%</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">filings_class =</span> <span class="fu">ntile</span>(total_filings, <span class="dv">3</span>),</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_class =</span> <span class="fu">ntile</span>(median_rent, <span class="dv">3</span>),</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bi_class =</span> <span class="fu">paste0</span>(rent_class, <span class="st">"-"</span>, filings_class)</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define bivariate color palette (different colors for this one)</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>bivariate_colors2 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-1"</span> <span class="ot">=</span> <span class="st">"#e8e8e8"</span>,  <span class="co"># Low rent, Low evictions</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-1"</span> <span class="ot">=</span> <span class="st">"#b8d6be"</span>,  <span class="co"># Med rent, Low evictions</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-1"</span> <span class="ot">=</span> <span class="st">"#73ae80"</span>,  <span class="co"># High rent, Low evictions</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-2"</span> <span class="ot">=</span> <span class="st">"#dfb0d6"</span>,  <span class="co"># Low rent, Med evictions</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-2"</span> <span class="ot">=</span> <span class="st">"#a5add3"</span>,  <span class="co"># Med rent, Med evictions</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-2"</span> <span class="ot">=</span> <span class="st">"#5698b9"</span>,  <span class="co"># High rent, Med evictions</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-3"</span> <span class="ot">=</span> <span class="st">"#be64ac"</span>,  <span class="co"># Low rent, High evictions</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-3"</span> <span class="ot">=</span> <span class="st">"#8c62aa"</span>,  <span class="co"># Med rent, High evictions</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-3"</span> <span class="ot">=</span> <span class="st">"#3b4994"</span>   <span class="co"># High rent, High evictions</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(map_sf) <span class="sc">+</span></span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> bi_class), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors2, <span class="at">na.value =</span> <span class="st">"grey90"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Eviction Filings vs Median Rent"</span>,</span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Darker purple = High evictions AND high rent"</span></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a>legend_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bi_class =</span> <span class="fu">paste0</span>(x, <span class="st">"-"</span>, y))</span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a>legend2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(legend_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> bi_class)) <span class="sc">+</span></span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors2, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Rent →"</span>, <span class="at">y =</span> <span class="st">"Evict. →"</span>) <span class="sc">+</span></span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))</span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a>final_plot2 <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(map2, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(legend2, <span class="fl">0.7</span>, <span class="fl">0.05</span>, <span class="fl">0.22</span>, <span class="fl">0.22</span>)</span>
<span id="cb105-64"><a href="#cb105-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-65"><a href="#cb105-65" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This map shows that high eviction areas are predominantly concentrated in lower-rent neighborhoods in North and West Philadelphia. High-rent tracts in Center City, University City, and the Far Northeast tend to have lower eviction rates.</p>
</section>
<section id="evication-vs-median-household-income" class="level3">
<h3 class="anchored" data-anchor-id="evication-vs-median-household-income">Evication vs Median Household Income</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  <span class="co"># ADD THIS LINE</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_filings =</span> <span class="fu">sum</span>(filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_income =</span> <span class="fu">first</span>(median_hh_income),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> philly_tract_sf <span class="sc">%&gt;%</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(map_data, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_filings) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(median_income))</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create tertiles for each variable</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> map_sf <span class="sc">%&gt;%</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">filings_class =</span> <span class="fu">ntile</span>(total_filings, <span class="dv">3</span>),</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_class =</span> <span class="fu">ntile</span>(median_income, <span class="dv">3</span>),</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bi_class =</span> <span class="fu">paste0</span>(income_class, <span class="st">"-"</span>, filings_class)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define bivariate color palette (blue-red for income-eviction)</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>bivariate_colors3 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-1"</span> <span class="ot">=</span> <span class="st">"#e8e8e8"</span>,  <span class="co"># Low income, Low evictions</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-1"</span> <span class="ot">=</span> <span class="st">"#b5c0da"</span>,  <span class="co"># Med income, Low evictions</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-1"</span> <span class="ot">=</span> <span class="st">"#6c83b5"</span>,  <span class="co"># High income, Low evictions</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-2"</span> <span class="ot">=</span> <span class="st">"#f0b8b8"</span>,  <span class="co"># Low income, Med evictions</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-2"</span> <span class="ot">=</span> <span class="st">"#ad9ea5"</span>,  <span class="co"># Med income, Med evictions</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-2"</span> <span class="ot">=</span> <span class="st">"#567994"</span>,  <span class="co"># High income, Med evictions</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1-3"</span> <span class="ot">=</span> <span class="st">"#e64b35"</span>,  <span class="co"># Low income, High evictions</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2-3"</span> <span class="ot">=</span> <span class="st">"#985356"</span>,  <span class="co"># Med income, High evictions</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3-3"</span> <span class="ot">=</span> <span class="st">"#3b4994"</span>   <span class="co"># High income, High evictions</span></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>map3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(map_sf) <span class="sc">+</span></span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> bi_class), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors3, <span class="at">na.value =</span> <span class="st">"grey90"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Eviction Filings vs Median Household Income"</span>,</span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Orange = High evictions AND low income"</span></span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>legend_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bi_class =</span> <span class="fu">paste0</span>(x, <span class="st">"-"</span>, y))</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>legend3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(legend_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> bi_class)) <span class="sc">+</span></span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> bivariate_colors3, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Income →"</span>, <span class="at">y =</span> <span class="st">"Evict. →"</span>) <span class="sc">+</span></span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">5</span>)),</span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">5</span>))</span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>final_plot3 <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(map3, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(legend3, <span class="fl">0.7</span>, <span class="fl">0.05</span>, <span class="fl">0.22</span>, <span class="fl">0.22</span>)</span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This map shows that most vulnerable tracts—high evictions combined with low household income—concentrated heavily in North Philadelphia, West Philadelphia, and Southwest Philadelphia. Higher-income areas such as Center City, Chestnut Hill, and the Far Northeast consistently show lower eviction rates, demonstrating that evictions disproportionately burden Philadelphia’s lowest-income communities where residents have the less financial cushion to absorb economic moves.</p>
</section>
</section>
<section id="the-evidence-soluation" class="level1">
<h1>THE EVIDENCE &amp; SOLUATION</h1>
<p><strong>Major Finding:</strong> Eviction filings stayed extremely low before September 2021 because Philadelphia’s local Emergency Housing Protection Act (March–August 2020), PHA’s internal eviction moratorium (March 2020–March 15, 2021), and the federal CDC eviction moratorium (September 2020–August 26, 2021) collectively prevented most cases from being filed. Once the CDC moratorium was struck down in late August 2021, these protections ended for the majority of renters. As a result, eviction filings began to rise again starting in fall 2021 and continued increasing into 2022.</p>
<section id="regression" class="level2">
<h2 class="anchored" data-anchor-id="regression">Regression</h2>
<section id="calculate-eviction-rate-per-population-and-define-outlier-threshold" class="level3">
<h3 class="anchored" data-anchor-id="calculate-eviction-rate-per-population-and-define-outlier-threshold">Calculate eviction rate per population and define outlier threshold</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate eviction by population</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>df_final<span class="sc">$</span>evibypop<span class="ot">=</span>df_final<span class="sc">$</span>filings_2020<span class="sc">/</span>df_final<span class="sc">$</span>total_pop<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>outlier_threshold <span class="ot">&lt;-</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(filings_2020)) <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(filings_2020) <span class="sc">%&gt;%</span>          </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fl">0.99</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co">#filter 2020 April, may and June</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="ot">=</span> df_final <span class="sc">%&gt;%</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>total_pop<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(median_rent.y))<span class="sc">%&gt;%</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(filings_2020 <span class="sc">&lt;=</span> outlier_threshold)<span class="sc">%&gt;%</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mora =</span> <span class="fu">ifelse</span>(<span class="fu">ymd</span>(week_date) <span class="sc">&gt;</span> <span class="fu">ymd</span>(<span class="st">"2020-02-01"</span>) <span class="sc">&amp;</span> <span class="fu">ymd</span>(week_date) <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2021-09-01"</span>), <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, week_date) <span class="sc">%&gt;%</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">evictions_lag1 =</span> <span class="fu">lag</span>(filings_2020, <span class="dv">1</span>),</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">evictions_lag3 =</span> <span class="fu">lag</span>(filings_2020, <span class="dv">3</span>),</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployment_lag1 =</span> <span class="fu">lag</span>(unemployment_rate, <span class="dv">1</span>),</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_change =</span> median_rent.y <span class="sc">-</span> <span class="fu">lag</span>(median_rent.y, <span class="dv">1</span>)</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_filtered)</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 70% training, 30% testing</span></span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> n)</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> df_filtered[train_indices, ]</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> df_filtered[<span class="sc">-</span>train_indices, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-1-ols-regression-of-eviction-rate-on-demographic-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="model-1-ols-regression-of-eviction-rate-on-demographic-characteristics">Model 1: OLS regression of eviction rate on demographic characteristics</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:raster':

    area, select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:terra':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:spatstat.geom':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run regression based on census characteristic</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">=</span><span class="fu">lm</span>(evibypop<span class="sc">~</span>pct_white<span class="sc">+</span>median_hh_income<span class="sc">+</span>pct_renter<span class="sc">+</span>unemployment_rate<span class="sc">+</span>median_year_built_renter<span class="sc">+</span>aggregate_rooms<span class="sc">+</span>pct_family<span class="sc">+</span>total_hh<span class="sc">+</span>pct_black<span class="sc">+</span>pct_asian,<span class="at">data=</span>df_filtered)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = evibypop ~ pct_white + median_hh_income + pct_renter + 
    unemployment_rate + median_year_built_renter + aggregate_rooms + 
    pct_family + total_hh + pct_black + pct_asian, data = df_filtered)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.15397 -0.04096 -0.01231  0.02362  1.24814 

Coefficients:
                               Estimate     Std. Error t value
(Intercept)              -0.57469215362  0.04001584925 -14.362
pct_white                -0.00040620691  0.00003272359 -12.413
median_hh_income         -0.00000005138  0.00000001557  -3.299
pct_renter                0.00068956524  0.00002466842  27.953
unemployment_rate        -0.00692133990  0.00009518153 -72.717
median_year_built_renter  0.00034707109  0.00002071004  16.759
aggregate_rooms           0.00001266260  0.00000285197   4.440
pct_family               -0.00008707624  0.00003131091  -2.781
total_hh                 -0.00002105811  0.00000308088  -6.835
pct_black                 0.00025333239  0.00002551365   9.929
pct_asian                -0.00087608946  0.00004903516 -17.867
                                     Pr(&gt;|t|)    
(Intercept)              &lt; 0.0000000000000002 ***
pct_white                &lt; 0.0000000000000002 ***
median_hh_income                     0.000972 ***
pct_renter               &lt; 0.0000000000000002 ***
unemployment_rate        &lt; 0.0000000000000002 ***
median_year_built_renter &lt; 0.0000000000000002 ***
aggregate_rooms               0.0000090197903 ***
pct_family                           0.005421 ** 
total_hh                      0.0000000000083 ***
pct_black                &lt; 0.0000000000000002 ***
pct_asian                &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06998 on 44738 degrees of freedom
  (600 observations deleted due to missingness)
Multiple R-squared:  0.2337,    Adjusted R-squared:  0.2335 
F-statistic:  1364 on 10 and 44738 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="check-multicollinearity-using-vif" class="level3">
<h3 class="anchored" data-anchor-id="check-multicollinearity-using-vif">Check multicollinearity using VIF</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               pct_white         median_hh_income               pct_renter 
                8.258080                 2.656026                 2.289253 
       unemployment_rate median_year_built_renter          aggregate_rooms 
                1.006781                 1.213637                30.104904 
              pct_family                 total_hh                pct_black 
                2.295712                30.486417                 6.274107 
               pct_asian 
                1.501459 </code></pre>
</div>
</div>
</section>
<section id="breusch-pagan-test-for-heteroskedasticity" class="level3">
<h3 class="anchored" data-anchor-id="breusch-pagan-test-for-heteroskedasticity">Breusch-Pagan test for heteroskedasticity</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model1
BP = 2111.2, df = 10, p-value &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-1-negative-binomial-regression-with-population-offset-and-rmse-calculation" class="level3">
<h3 class="anchored" data-anchor-id="model-1-negative-binomial-regression-with-population-offset-and-rmse-calculation">Model 1: Negative binomial regression with population offset and RMSE calculation</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#p-value is way too small, implying more variables may be needed (make sense)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>model_train_1 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  filings_2020 <span class="sc">~</span> pct_white <span class="sc">+</span> median_hh_income <span class="sc">+</span> pct_renter <span class="sc">+</span> unemployment_rate <span class="sc">+</span> </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  median_year_built_renter <span class="sc">+</span> aggregate_rooms <span class="sc">+</span> pct_family <span class="sc">+</span> total_hh <span class="sc">+</span> </span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  pct_black <span class="sc">+</span> pct_asian <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(total_pop)), </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. PREDICT &amp; EVALUATE</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use type = "response" to get actual eviction counts</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RMSE</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>test_predictions_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_1, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>rmse_test_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_1)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Train RMSE (replacing summary$sigma)</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>train_predictions_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_1, <span class="at">newdata =</span> train_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>rmse_train_1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_1)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. OUTPUT</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Train RMSE:"</span>, <span class="fu">round</span>(rmse_train_1, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Train RMSE: 2.42"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Test RMSE:"</span>, <span class="fu">round</span>(rmse_test_1, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test RMSE: 2.4"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-2-ols-regression-adding-economic-indicators-rent-cpi-wages" class="level3">
<h3 class="anchored" data-anchor-id="model-2-ols-regression-adding-economic-indicators-rent-cpi-wages">Model 2: OLS regression adding economic indicators (rent, CPI, wages)</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">lm</span>(filings_2020<span class="sc">~</span>median_rent.y<span class="sc">+</span>foodcpi<span class="sc">+</span>electricitycpi<span class="sc">+</span>avg_wkly_wage<span class="sc">+</span>median_rent.y<span class="sc">+</span>median_hh_income<span class="sc">+</span>pct_renter<span class="sc">+</span>unemployment_rate<span class="sc">+</span>median_year_built_renter<span class="sc">+</span>pct_family<span class="sc">+</span>pct_black<span class="sc">+</span>pct_asian<span class="sc">+</span>comcpi<span class="sc">+</span>total_pop,<span class="at">data=</span>df_filtered)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = filings_2020 ~ median_rent.y + foodcpi + electricitycpi + 
    avg_wkly_wage + median_rent.y + median_hh_income + pct_renter + 
    unemployment_rate + median_year_built_renter + pct_family + 
    pct_black + pct_asian + comcpi + total_pop, data = df_filtered)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.6082 -1.5267 -0.4423  0.9204 12.6495 

Coefficients:
                               Estimate     Std. Error t value
(Intercept)              -12.5863646489   1.3974004667  -9.007
median_rent.y             -0.0003980286   0.0000302792 -13.145
foodcpi                   -0.0502807033   0.0033166992 -15.160
electricitycpi             0.0648782410   0.0026617240  24.375
avg_wkly_wage              0.0025960330   0.0002059253  12.607
median_hh_income           0.0000004135   0.0000005051   0.819
pct_renter                 0.0293518224   0.0008235482  35.641
unemployment_rate         -0.2814176253   0.0054239719 -51.884
median_year_built_renter   0.0085063225   0.0007006636  12.140
pct_family                 0.0071971239   0.0010312869   6.979
pct_black                  0.0216845144   0.0004851457  44.697
pct_asian                 -0.0244308994   0.0015801617 -15.461
comcpi                    -0.0325427865   0.0022199971 -14.659
total_pop                  0.0003713680   0.0000080294  46.251
                                     Pr(&gt;|t|)    
(Intercept)              &lt; 0.0000000000000002 ***
median_rent.y            &lt; 0.0000000000000002 ***
foodcpi                  &lt; 0.0000000000000002 ***
electricitycpi           &lt; 0.0000000000000002 ***
avg_wkly_wage            &lt; 0.0000000000000002 ***
median_hh_income                        0.413    
pct_renter               &lt; 0.0000000000000002 ***
unemployment_rate        &lt; 0.0000000000000002 ***
median_year_built_renter &lt; 0.0000000000000002 ***
pct_family                   0.00000000000302 ***
pct_black                &lt; 0.0000000000000002 ***
pct_asian                &lt; 0.0000000000000002 ***
comcpi                   &lt; 0.0000000000000002 ***
total_pop                &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.407 on 44735 degrees of freedom
  (600 observations deleted due to missingness)
Multiple R-squared:  0.2923,    Adjusted R-squared:  0.2921 
F-statistic:  1421 on 13 and 44735 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="check-multicollinearity-for-model-2" class="level3">
<h3 class="anchored" data-anchor-id="check-multicollinearity-for-model-2">Check multicollinearity for Model 2</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           median_rent.y                  foodcpi           electricitycpi 
                1.601759                36.670359                26.227915 
           avg_wkly_wage         median_hh_income               pct_renter 
                2.254253                 2.360784                 2.155998 
       unemployment_rate median_year_built_renter               pct_family 
                2.762638                 1.173831                 2.104477 
               pct_black                pct_asian                   comcpi 
                1.916947                 1.317530                10.570811 
               total_pop 
                1.229465 </code></pre>
</div>
</div>
</section>
<section id="breusch-pagan-test-for-heteroskedasticity-in-model-2" class="level3">
<h3 class="anchored" data-anchor-id="breusch-pagan-test-for-heteroskedasticity-in-model-2">Breusch-Pagan test for heteroskedasticity in Model 2</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model2
BP = 3187.5, df = 13, p-value &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-2-negative-binomial-regression-with-economic-indicators-and-rmse-calculation" class="level3">
<h3 class="anchored" data-anchor-id="model-2-negative-binomial-regression-with-economic-indicators-and-rmse-calculation">Model 2: Negative binomial regression with economic indicators and RMSE calculation</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the RMSE</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>model_train_2 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  filings_2020 <span class="sc">~</span> median_rent.y <span class="sc">+</span> foodcpi <span class="sc">+</span> electricitycpi <span class="sc">+</span> avg_wkly_wage <span class="sc">+</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  median_hh_income <span class="sc">+</span> pct_renter <span class="sc">+</span> unemployment_rate <span class="sc">+</span> median_year_built_renter <span class="sc">+</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  pct_family <span class="sc">+</span> pct_black <span class="sc">+</span> comcpi <span class="sc">+</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">offset</span>(<span class="fu">log</span>(total_pop)), </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Test RMSE</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>test_predictions_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_2, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>rmse_test_2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Train RMSE (replacing summary$sigma)</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>train_predictions_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_2, <span class="at">newdata =</span> train_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>rmse_train_2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. OUTPUT</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Train RMSE:"</span>, <span class="fu">round</span>(rmse_train_2, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Train RMSE: 2.41"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Test RMSE:"</span>, <span class="fu">round</span>(rmse_test_2, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test RMSE: 2.39"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-36-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-36-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-3-ols-regression-with-income-quantiles-as-categorical-variable" class="level3">
<h3 class="anchored" data-anchor-id="model-3-ols-regression-with-income-quantiles-as-categorical-variable">Model 3: OLS regression with income quantiles as categorical variable</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">lm</span>(filings_2020<span class="sc">~</span>median_rent.y<span class="sc">+</span>avg_wkly_wage<span class="sc">+</span>median_rent.y<span class="sc">+</span>median_hh_income<span class="sc">+</span>pct_renter<span class="sc">+</span>unemployment_rate<span class="sc">+</span>median_year_built_renter<span class="sc">+</span>pct_family<span class="sc">+</span>pct_black<span class="sc">+</span>electricitycpi<span class="sc">+</span>total_pop<span class="sc">+</span>MHI_quantile,<span class="at">data=</span>df_filtered)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = filings_2020 ~ median_rent.y + avg_wkly_wage + median_rent.y + 
    median_hh_income + pct_renter + unemployment_rate + median_year_built_renter + 
    pct_family + pct_black + electricitycpi + total_pop + MHI_quantile, 
    data = df_filtered)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.1903 -1.5452 -0.4586  0.9141 12.9222 

Coefficients:
                               Estimate     Std. Error t value
(Intercept)              -15.0282217892   1.4426536755 -10.417
median_rent.y             -0.0004972586   0.0000316586 -15.707
avg_wkly_wage              0.0004038660   0.0001936453   2.086
median_hh_income           0.0000009808   0.0000005711   1.717
pct_renter                 0.0285284241   0.0008735138  32.659
unemployment_rate         -0.2423153584   0.0048748846 -49.707
median_year_built_renter   0.0069001773   0.0007316509   9.431
pct_family                 0.0087003485   0.0010831729   8.032
pct_black                  0.0249947980   0.0004795878  52.117
electricitycpi             0.0056185191   0.0008251418   6.809
total_pop                  0.0003631177   0.0000083990  43.233
MHI_quantileQ2            -0.0698093398   0.0344698894  -2.025
MHI_quantileQ3             0.1389832212   0.0385251150   3.608
MHI_quantileQ4 (highest)   0.1187769212   0.0456625457   2.601
                                     Pr(&gt;|t|)    
(Intercept)              &lt; 0.0000000000000002 ***
median_rent.y            &lt; 0.0000000000000002 ***
avg_wkly_wage                        0.037021 *  
median_hh_income                     0.085937 .  
pct_renter               &lt; 0.0000000000000002 ***
unemployment_rate        &lt; 0.0000000000000002 ***
median_year_built_renter &lt; 0.0000000000000002 ***
pct_family               0.000000000000000982 ***
pct_black                &lt; 0.0000000000000002 ***
electricitycpi           0.000000000009949190 ***
total_pop                &lt; 0.0000000000000002 ***
MHI_quantileQ2                       0.042850 *  
MHI_quantileQ3                       0.000309 ***
MHI_quantileQ4 (highest)             0.009293 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.437 on 41974 degrees of freedom
  (3361 observations deleted due to missingness)
Multiple R-squared:  0.2784,    Adjusted R-squared:  0.2782 
F-statistic:  1246 on 13 and 41974 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="check-multicollinearity-for-model-3" class="level3">
<h3 class="anchored" data-anchor-id="check-multicollinearity-for-model-3">Check multicollinearity for Model 3</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             GVIF Df GVIF^(1/(2*Df))
median_rent.y            1.614122  1        1.270481
avg_wkly_wage            1.825175  1        1.350990
median_hh_income         2.820727  1        1.679502
pct_renter               2.179792  1        1.476412
unemployment_rate        2.043331  1        1.429451
median_year_built_renter 1.172989  1        1.083046
pct_family               2.123113  1        1.457091
pct_black                1.742903  1        1.320190
electricitycpi           2.307622  1        1.519086
total_pop                1.229771  1        1.108951
MHI_quantile             2.267698  3        1.146210</code></pre>
</div>
</div>
</section>
<section id="breusch-pagan-test-for-heteroskedasticity-in-model-3" class="level3">
<h3 class="anchored" data-anchor-id="breusch-pagan-test-for-heteroskedasticity-in-model-3">Breusch-Pagan test for heteroskedasticity in Model 3</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  model3
BP = 2825.9, df = 13, p-value &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-3-negative-binomial-regression-with-year-fixed-effects-income-quantiles-and-moratorium-indicator" class="level3">
<h3 class="anchored" data-anchor-id="model-3-negative-binomial-regression-with-year-fixed-effects-income-quantiles-and-moratorium-indicator">Model 3: Negative binomial regression with year fixed effects, income quantiles, and moratorium indicator</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Fit the model</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>model_train_3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  filings_2020 <span class="sc">~</span> median_rent.y <span class="sc">+</span> avg_wkly_wage <span class="sc">+</span> median_hh_income <span class="sc">+</span> </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  pct_renter <span class="sc">+</span> unemployment_rate <span class="sc">+</span> median_year_built_renter <span class="sc">+</span> </span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  pct_family <span class="sc">+</span> pct_black <span class="sc">+</span> electricitycpi <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> </span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  MHI_quantile <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(total_pop))<span class="sc">+</span>mora<span class="sc">+</span>EconKDE<span class="sc">+</span><span class="fu">I</span>(EconKDE<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Predict on </span><span class="al">TEST</span><span class="co"> data </span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: type = "response" is crucial to get 'counts' instead of 'log-odds'</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>test_predictions_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_3, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calculate </span><span class="al">TEST</span><span class="co"> RMSE</span></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>rmse_test_3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_3)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Calculate TRAIN RMSE (Replacement for 'sigma')</span></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="co"># We must predict on the training data manually to get an equivalent metric</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>train_predictions_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_3, <span class="at">newdata =</span> train_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>rmse_train_3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_3)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Train RMSE:"</span>, <span class="fu">round</span>(rmse_train_3, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Train RMSE: 2.34"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Test RMSE:"</span>, <span class="fu">round</span>(rmse_test_3, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test RMSE: 2.32"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-40-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="appendix_files/figure-html/unnamed-chunk-40-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Feature Engineering</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>df_model4 <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rent-to-income ratio (replaces having both separately)</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_income =</span> median_rent.y <span class="sc">/</span> (median_hh_income <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_to_income =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(rent_to_income) <span class="sc">|</span> rent_to_income <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="cn">NA</span>, rent_to_income),</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log transforms</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_pop =</span> <span class="fu">log</span>(total_pop <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_rent =</span> <span class="fu">log</span>(median_rent.y <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Temporal features</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mora =</span> <span class="fu">ifelse</span>(week_date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2020-03-01"</span>) <span class="sc">&amp;</span> week_date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-08-31"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_mora =</span> <span class="fu">ifelse</span>(week_date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2021-09-01"</span>) <span class="sc">&amp;</span> week_date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-03-31"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">winter =</span> <span class="fu">ifelse</span>(<span class="fu">month</span>(week_date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">12</span>, <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lagged unemployment</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, week_date) <span class="sc">%&gt;%</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unemployment_lag1 =</span> <span class="fu">lag</span>(unemployment_rate, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unemployment_lag3 =</span> <span class="fu">lag</span>(unemployment_rate, <span class="dv">3</span>))<span class="sc">%&gt;%</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(unemployment_lag1))</span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Spatial train/test split (by tract)</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>unique_tracts <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_model4<span class="sc">$</span>GEOID)</span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a>train_tracts <span class="ot">&lt;-</span> <span class="fu">sample</span>(unique_tracts, <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">length</span>(unique_tracts))</span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>train_data4 <span class="ot">&lt;-</span> df_model4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> train_tracts)</span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a>test_data4 <span class="ot">&lt;-</span> df_model4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>GEOID <span class="sc">%in%</span> train_tracts)</span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Fit Model 4</span></span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a>model_train_4 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a>  filings_2020 <span class="sc">~</span> </span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>    unemployment_rate  <span class="sc">+</span>unemployment_lag3<span class="sc">+</span> avg_wkly_wage <span class="sc">+</span> electricitycpi <span class="sc">+</span></span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a>    log_rent <span class="sc">+</span> pct_renter <span class="sc">+</span> rent_to_income <span class="sc">+</span></span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a>    pct_black <span class="sc">+</span> pct_family <span class="sc">+</span></span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a>    mora <span class="sc">+</span> post_mora <span class="sc">+</span> winter <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span></span>
<span id="cb147-39"><a href="#cb147-39" aria-hidden="true" tabindex="-1"></a>    MHI_quantile  <span class="sc">+</span></span>
<span id="cb147-40"><a href="#cb147-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(log_pop)<span class="sc">+</span>EconKDE<span class="sc">+</span>pct_rent_burdened,</span>
<span id="cb147-41"><a href="#cb147-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data4</span>
<span id="cb147-42"><a href="#cb147-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb147-43"><a href="#cb147-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-44"><a href="#cb147-44" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_train_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = filings_2020 ~ unemployment_rate + unemployment_lag3 + 
    avg_wkly_wage + electricitycpi + log_rent + pct_renter + 
    rent_to_income + pct_black + pct_family + mora + post_mora + 
    winter + factor(year) + MHI_quantile + offset(log_pop) + 
    EconKDE + pct_rent_burdened, data = train_data4, init.theta = 2.121764757, 
    link = log)

Coefficients:
                              Estimate    Std. Error z value
(Intercept)                 -9.5612324     0.3543602 -26.982
unemployment_rate           -0.2520619     0.0071690 -35.160
unemployment_lag3            0.0545751     0.0056609   9.641
avg_wkly_wage                0.0016273     0.0001291  12.602
electricitycpi               0.0049510     0.0012243   4.044
log_rent                    -0.0677665     0.0328116  -2.065
pct_renter                   0.0198019     0.0004883  40.549
rent_to_income              -0.3383452     0.0490308  -6.901
pct_black                    0.0094036     0.0002358  39.879
pct_family                  -0.0058630     0.0006239  -9.397
mora                        -0.2057837     0.0401631  -5.124
post_mora                   -0.3364993     0.0281822 -11.940
winter                      -0.0325574     0.0170956  -1.904
factor(year)2021            -0.3037098     0.0274146 -11.078
factor(year)2022            -0.4250358     0.0442296  -9.610
factor(year)2023            -0.7735563     0.0600288 -12.886
MHI_quantileQ2              -0.0510969     0.0168392  -3.034
MHI_quantileQ3              -0.0196224     0.0192760  -1.018
MHI_quantileQ4 (highest)     0.0907962     0.0239786   3.787
EconKDE                  -5259.4976347   185.9899858 -28.278
pct_rent_burdened            0.0010735     0.0004620   2.324
                                     Pr(&gt;|z|)    
(Intercept)              &lt; 0.0000000000000002 ***
unemployment_rate        &lt; 0.0000000000000002 ***
unemployment_lag3        &lt; 0.0000000000000002 ***
avg_wkly_wage            &lt; 0.0000000000000002 ***
electricitycpi               0.00005257812035 ***
log_rent                             0.038893 *  
pct_renter               &lt; 0.0000000000000002 ***
rent_to_income               0.00000000000518 ***
pct_black                &lt; 0.0000000000000002 ***
pct_family               &lt; 0.0000000000000002 ***
mora                         0.00000029960166 ***
post_mora                &lt; 0.0000000000000002 ***
winter                               0.056854 .  
factor(year)2021         &lt; 0.0000000000000002 ***
factor(year)2022         &lt; 0.0000000000000002 ***
factor(year)2023         &lt; 0.0000000000000002 ***
MHI_quantileQ2                       0.002410 ** 
MHI_quantileQ3                       0.308694    
MHI_quantileQ4 (highest)             0.000153 ***
EconKDE                  &lt; 0.0000000000000002 ***
pct_rent_burdened                    0.020139 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.1218) family taken to be 1)

    Null deviance: 47456  on 28715  degrees of freedom
Residual deviance: 30517  on 28695  degrees of freedom
  (2616 observations deleted due to missingness)
AIC: 102361

Number of Fisher Scoring iterations: 1

              Theta:  2.1218 
          Std. Err.:  0.0403 

 2 x log-likelihood:  -102317.3560 </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Evaluate</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>test_predictions_4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_4, <span class="at">newdata =</span> test_data4, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>train_predictions_4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train_4, <span class="at">newdata =</span> train_data4, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>rmse_test_4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>rmse_train_4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Train RMSE:"</span>, <span class="fu">round</span>(rmse_train_4, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Train RMSE: 2.34"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Test RMSE:"</span>, <span class="fu">round</span>(rmse_test_4, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test RMSE: 2.24"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== RMSE =====</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>rmse_test_4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((test_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>rmse_train_4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((train_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== MAE (Mean Absolute Error) =====</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>mae_test_4 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(test_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>mae_train_4 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(train_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== R² (R-squared) =====</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Test R²</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>ss_res_test <span class="ot">&lt;-</span> <span class="fu">sum</span>((test_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> test_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>ss_tot_test <span class="ot">&lt;-</span> <span class="fu">sum</span>((test_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> <span class="fu">mean</span>(test_data4<span class="sc">$</span>filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>r2_test_4 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res_test <span class="sc">/</span> ss_tot_test)</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Train R²</span></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>ss_res_train <span class="ot">&lt;-</span> <span class="fu">sum</span>((train_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> train_predictions_4)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>ss_tot_train <span class="ot">&lt;-</span> <span class="fu">sum</span>((train_data4<span class="sc">$</span>filings_2020 <span class="sc">-</span> <span class="fu">mean</span>(train_data4<span class="sc">$</span>filings_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>r2_train_4 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_res_train <span class="sc">/</span> ss_tot_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'pscl' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Classes and Methods for R originally developed in the
Political Science Computational Laboratory
Department of Political Science
Stanford University (2002-2015),
by and under the direction of Simon Jackman.
hurdle and zeroinfl functions by Achim Zeileis.</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== McFadden's R² =====</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Using pscl package (easiest)</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>mcfadden_r2 <span class="ot">&lt;-</span> <span class="fu">pR2</span>(model_train_4)[<span class="st">"McFadden"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"McFadden's R²: %.4f</span><span class="sc">\n</span><span class="st">"</span>, mcfadden_r2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>McFadden's R²: 0.1210</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Manual calculation (more control)</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit null model (intercept only with offset)</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  filings_2020 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(log_pop), </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data4</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate McFadden's R²</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>logLik_full <span class="ot">&lt;-</span> <span class="fu">logLik</span>(model_train_4)[<span class="dv">1</span>]</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>logLik_null <span class="ot">&lt;-</span> <span class="fu">logLik</span>(null_model)[<span class="dv">1</span>]</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>mcfadden_r2_manual <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (logLik_full <span class="sc">/</span> logLik_null)</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">McFadden's R² (manual): %.4f</span><span class="sc">\n</span><span class="st">"</span>, mcfadden_r2_manual))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
McFadden's R² (manual): 0.1927</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted McFadden's R²</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(model_train_4))  <span class="co"># number of parameters</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>mcfadden_adj <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ((logLik_full <span class="sc">-</span> k) <span class="sc">/</span> logLik_null)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Adjusted McFadden's R²: %.4f</span><span class="sc">\n</span><span class="st">"</span>, mcfadden_adj))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Adjusted McFadden's R²: 0.1924</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="the-implementation" class="level1">
<h1>THE IMPLEMENTATION</h1>
<p>One of the primary ways to implement this tool is to develop a Monthly Risk Score based on the prediction. It would be helpful for city agencies to have a map that shows predicted high-risk census tracts and updates the predictions monthly as new data arrives. When a specific tract’s risk score exceeds a certain threshold, the city agency should deploy resources to prevent eviction from occurring.</p>
<p>From the user’s perspective, it would be beneficial to develop an Emergency Rental Assistance Application program. This program should also coordinate with the courts to flag cases that appear in high-risk areas.</p>
<p>From a data perspective, we already have the eviction filing, census tract demographics, and economic indicators. These existing resources already provide a large foundation for our prediction model and serve as the base for policy implementation. However, it would also be essential to continue having tools like real-time rental listings that track how the rental listing shifts, as long as these other factors are taken into account.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>